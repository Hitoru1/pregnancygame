<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="HandheldFriendly" content="true">
  <meta name="screen-orientation" content="landscape">
  <meta name="full-screen" content="yes">
  <meta name="x5-fullscreen" content="true">
  <meta name="x5-orientation" content="landscape">
  <title>Scream to Deliver</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/addons/p5.sound.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

  <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&display=swap" rel="stylesheet">

  <style>
    * {
      box-sizing: border-box;
      touch-action: manipulation;
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      overflow: hidden;
      font-family: 'Comic Neue', cursive;
      background: linear-gradient(to bottom, #c0e6f0, #a7cde2);
    }

    /* Force landscape orientation */
    @media screen and (orientation:portrait) {
      body {
        transform: rotate(90deg);
        transform-origin: left top;
        width: 100vh;
        height: 100vw;
        overflow-x: hidden;
        position: absolute;
        top: 100%;
        left: 0;
      }
    }

    #start-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 10;
      animation: fadeIn 0.6s ease-in-out;
    }

    #start-screen img {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: -1;
    }

    .menu-button {
      position: absolute;
      background: transparent;
      border: none;
      cursor: pointer;
      z-index: 11;
      transition: background 0.3s;
      padding: 0;
      margin: 0;
      overflow: hidden;
      text-indent: -9999px;
    }

    .menu-button:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    #start-btn {
      width: 35%;
      height: 25%;
      top: 10%;
      left: 10%;
    }

    #help-btn {
      width: 25%;
      height: 12%;
      top: 35%;
      left: 15%;
    }

    #leaderboard-btn {
      width: 30%;
      height: 12%;
      top: 50%;
      left: 15%;
    }

    #exit-btn {
      width: 25%;
      height: 12%;
      top: 65%;
      left: 15%;
    }

    #mute-btn {
      height: 30px;
      width: 30px;
      background: transparent;
      position: absolute;
      top: 4%;
      left: 95%;
      border: none;
      color: white;
      cursor: pointer;
      overflow: hidden;
      z-index: 12;
    }

    #mute-btn::before {
      content: '';
      display: block;
      position: absolute;
      width: 120%;
      height: 10%;
      top: 45%;
      left: -10%;
      background: transparent;
      transform: rotate(45deg);
      transform-origin: center center;
      pointer-events: none;
      transition: background-color 0.2s ease;
    }

    #mute-btn.muted::before {
      background: red;
    }

    .home-button {
      position: absolute;
      top: 2vw;
      right: 2vw;
      background-color: #6ab8d3;
      color: white;
      font-size: 4vw;
      padding: 0.4vw 3vw;
      border-radius: 15px;
      border: none;
      box-shadow: 2px 2px 10px rgba(0,0,0,0.2);
      display: none;
      z-index: 20;
      cursor: pointer;
      font-family: 'Comic Neue', cursive;
    }

    /* Back button for Leaderboard (Podium and Full List) */
    .back-button {
      position: fixed;
      top: 20px;
      left: 20px;
      width: 60px;
      height: 60px;
      background-color: #2c7986;
      border-radius: 50%;
      display: none;
      justify-content: center;
      align-items: center;
      color: white;
      font-size: 30px;
      border: none;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
      font-family: 'Comic Neue', cursive;
      z-index: 201;
    }

    .back-button:hover {
      background-color: #236570;
      transform: scale(1.05);
    }

    /* Name Input Popup Styles */
    #name-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(to bottom, #a7cde2, #8ac9db);
      padding: 20px;
      border-radius: 20px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      z-index: 100;
      display: none;
      flex-direction: column;
      align-items: center;
      border: 4px solid #6ab8d3;
      animation: bounceIn 0.5s;
      max-width: 90%;
      width: 350px;
    }

    #name-popup h2 {
      color: #003366;
      margin-top: 0;
      font-size: 1.8rem;
      text-align: center;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    }

    #name-input {
      width: 100%;
      padding: 12px;
      margin: 15px 0;
      border-radius: 10px;
      border: 3px solid #6ab8d3;
      font-family: 'Comic Neue', cursive;
      font-size: 1.1rem;
      outline: none;
      transition: all 0.3s;
    }

    #name-input:focus {
      border-color: #4a99b1;
      box-shadow: 0 0 10px rgba(106, 184, 211, 0.5);
    }

    #continue-btn {
      background-color: #6ab8d3;
      border: none;
      padding: 10px 20px;
      font-size: 1.1rem;
      color: white;
      border-radius: 10px;
      cursor: pointer;
      transition: 0.3s ease;
      font-family: 'Comic Neue', cursive;
      box-shadow: 0 4px 0 #4a99b1;
      width: 100%;
    }

    #continue-btn:hover {
      background-color: #4a99b1;
      transform: translateY(2px);
      box-shadow: 0 2px 0 #3a7d91;
    }

    #continue-btn:active {
      transform: translateY(4px);
      box-shadow: none;
    }

    #name-popup::before {
      content: '';
      position: absolute;
      top: -10px;
      left: -10px;
      right: -10px;
      bottom: -10px;
      border-radius: 25px;
      border: 2px dashed #6ab8d3;
      z-index: -1;
      pointer-events: none;
    }

    /* Congratulations Popup */
    #congrats-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(to bottom, #a7cde2, #8ac9db);
      padding: 20px;
      border-radius: 20px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      z-index: 100;
      display: none;
      flex-direction: column;
      align-items: center;
      border: 4px solid #6ab8d3;
      animation: bounceIn 0.5s;
      max-width: 90%;
      width: 350px;
      text-align: center;
    }

    #congrats-popup h2 {
      color: #003366;
      margin-top: 0;
      font-size: 1.8rem;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    }

    #congrats-popup p {
      font-size: 1.1rem;
      margin-bottom: 15px;
    }

    #congrats-popup img {
      width: 130px;
      height: auto;
      margin: 0 auto 15px;
      display: block;
    }

    #congrats-popup .popup-buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
    }

    #congrats-popup button {
      background-color: #6ab8d3;
      border: none;
      padding: 8px 16px;
      font-size: 1rem;
      color: white;
      border-radius: 10px;
      cursor: pointer;
      transition: 0.3s ease;
      font-family: 'Comic Neue', cursive;
    }

    #congrats-popup button:hover {
      background-color: #4a99b1;
    }

    /* New style for the baby after image */
    #baby-after-img {
        position: fixed;
        display: none;
        z-index: 101;
        width: 150px;
        height: auto;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        animation: fadeIn 0.5s ease-out;
    }


    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideIn {
      from {
        transform: translateY(-100px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    @keyframes bounceIn {
      0% {
        transform: translate(-50%, -50%) scale(0.8);
        opacity: 0;
      }
      50% {
        transform: translate(-50%, -50%) scale(1.05);
      }
      100% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
      }
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      20%, 60% { transform: translateX(-5px); }
      40%, 80% { transform: translateX(5px); }
    }

    /* Curtain Effect */
    #curtain {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 15;
      display: none;
    }

    #curtain::before, #curtain::after {
      content: '';
      position: absolute;
      top: 0;
      width: 50%;
      height: 100%;
      background: linear-gradient(to bottom, #6ab8d3, #a7cde2);
      z-index: 15;
    }

    #curtain::before {
      left: 0;
    }

    #curtain::after {
      right: 0;
    }

    .close-curtain::before {
      animation: curtainLeft 1.5s forwards;
    }

    .close-curtain::after {
      animation: curtainRight 1.5s forwards;
    }

    @keyframes curtainLeft {
      0% { transform: translateX(0); }
      100% { transform: translateX(-100%); }
    }

    @keyframes curtainRight {
      0% { transform: translateX(0); }
      100% { transform: translateX(100%); }
    }

    canvas {
      display: block;
      position: absolute;
      top: 0;
      left: 0;
      z-index: 1;
    }

    /* Help Screen */
    .help-screen {
      display: none;
      width: 100%;
      height: 100%;
      background-color: black;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 200;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      opacity: 0;
      transform: scale(0.95);
      transition: all 0.3s ease-out;
      pointer-events: none;
    }

    #help-img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      transition: transform 0.3s ease-out 0.1s;
      transform: translateY(20px);
    }

    #close-help {
      height: 40px;
      width: 40px;
      position: absolute;
      background: transparent;
      top: 50px;
      left: 35px;
      border: none;
      color: white;
      cursor: pointer;
    }

    /* Leaderboard Screen (Podium View) */
    .leaderboard-page {
      display: none;
      width: 100%;
      height: 100%;
      background-color: rgba(100, 200, 210, 0.9);
      background-image: url('bg_leaderboards.png');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 200;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      opacity: 0;
      transform: scale(0.95);
      transition: all 0.3s ease-out;
      pointer-events: none;
    }

    .leaderboard-container {
      width: 90%;
      max-width: 900px;
      height: 100%;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: 'Comic Neue', cursive;
    }

    .leaderboard-title {
      font-family: 'Comic Neue', cursive;
      font-size: 30px;
      color: white;
      text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.3);
      margin-bottom: 60px;
      text-align: center;
      background-color: #69b6bc;
      padding: 10px 40px;
      border-radius: 20px;
      letter-spacing: 3px;
      border: 4px solid white;

    }


    .podium-container {
      display: flex;
      justify-content: center;
      align-items: flex-end;
      width: 100%;
      height: 80%;
      position: relative;
    }

    .podium-position {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-end;
      width: 30%;
      height: 100%;
      position: relative;

    }

    .podium-block {
      width: 90%;
      background-color: #69b6bc;
      border-radius: 10px 10px 0 0;
      border-top: 4px solid white;
      border-left: 4px solid white;
      border-right: 4px solid white;
      box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.2);
      position: relative;
      transition: all 0.5s ease;
      display: flex;
      justify-content: center;
      align-items: center;

    }

    .first-place {
      height: 70%;
      margin-bottom: 0;
      background-color: #2d8c7a;
    }

    .second-place {
      height: 50%;
      margin-bottom: 0;
    }

    .third-place {
      height: 30%;
      margin-bottom: 0;
    }

    .position-number {
      font-size: 2.5rem;
      font-family: 'Comic Neue', cursive;
      font-weight: bold;
      color: white;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      z-index: 5;
    }

    .player-info {
      background-color: white;
      border-radius: 15px;
      padding: 10px 15px;
      margin-bottom: 20px;
      text-align: center;
      width: 80%;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      z-index: 5;
      font-family: 'Comic Neue', cursive;
    }

    .player-name {
      font-family: 'Comic Neue', cursive;
      font-weight: bold;
      font-size: 1.4rem;
      color: #2c7986;
      margin-bottom: 5px;
      text-overflow: ellipsis;
      overflow: hidden;
      white-space: nowrap;

    }

    .player-time {
      font-family: 'Comic Neue', cursive;
      font-size: 1.2rem;
      color: #5bcebc;

    }


    /* Animation classes */
    .leaderboard-page.active {
      opacity: 1;
      transform: scale(1);
      pointer-events: auto;
      display: flex;
    }

    .help-screen.active #help-img,
    .leaderboard-page.active #leaderboard-img {
      transform: translateY(0);
    }

    /* Responsive adjustments for leaderboard */
    @media (max-width: 768px) {
      .leaderboard-container {
          height: 85%;
      }
      .leaderboard-title {
        font-size: 2.5rem;
        margin-bottom: 25px;
        padding: 8px 25px;
      }

      .position-number {
        font-size: 1.5rem;
      }

      .player-info {
          padding: 6px 8px;
          margin-bottom: 12px;
          border-radius: 12px;
      }

      .player-name {
        font-size: 0.9rem;
      }

      .player-time {
        font-size: 0.8rem;
      }

        .back-button {
          width: 45px;
          height: 45px;
          font-size: 20px;
          top: 15px;
          left: 15px;
        }
    }

    @media (max-width: 480px) {
        .leaderboard-container {
          width: 95%;
          height: 90%;
          justify-content: flex-start;
          padding-top: 10px;
        }
      .leaderboard-title {
        font-size: 1.5rem;
        padding: 4px 8px;
        margin-bottom: 10px;
        letter-spacing: 1px;
        border-width: 3px;
        border-radius: 15px;
      }

      .podium-container {
        height: 55%;
        margin-top: 15px;
      }

      .position-number {
        font-size: 1.8rem;
      }

      .player-info {
        padding: 3px 5px;
        margin-bottom: 5px;
        border-radius: 8px;
      }

      .player-name {
        font-size: 0.65rem;
        margin-bottom: 1px;
      }

      .player-time {
        font-size: 0.6rem;
      }

        .back-button {
          width: 30px;
          height: 30px;
          font-size: 14px;
          top: 6px;
          left: 6px;
        }
     }


    .close-popup-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: transparent;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #003366;
      font-weight: bold;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.3s;
    }

    .close-popup-btn:hover {
      background: rgba(0, 0, 0, 0.1);
      transform: scale(1.1);
    }

    /* Add animation for the podium entries */
    .highlight .player-info {
      animation: pulse 1s infinite alternate;
    }

    @keyframes pulse {
      0% {
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }
      100% {
        box-shadow: 0 4px 12px rgba(91, 206, 188, 0.7);
      }
    }

    /* Full Leaderboard List Styles */
    #full-leaderboard-list {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: url('bg_leaderboards.png');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      z-index: 200;
      justify-content: center;
      align-items: flex-start;
      overflow-y: auto;
      padding: 20px;
      font-family: 'Comic Neue', cursive;
      opacity: 0;
      transition: opacity 0.3s ease-out;
      pointer-events: none;
    }

    #full-leaderboard-list.active {
        opacity: 1;
        pointer-events: auto;
        display: flex;
    }

    #full-leaderboard-list .leaderboard-title {
        margin-top: 0px;
        margin-bottom: 20px;
        font-size: 2rem;
        padding: 8px 30px;
    }

    #full-leaderboard-list .leaderboard-content {
        width: 95%;
        max-width: 600px;
        background-color: rgba(255, 255, 255, 0.9);
        border-radius: 15px;
        padding: 15px;
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
        margin-bottom: 20px;
    }

    #full-leaderboard-list table {
        width: 100%;
        border-collapse: collapse;
    }

    #full-leaderboard-list th, #full-leaderboard-list td {
        padding: 10px;
        text-align: left;
        border-bottom: 1px solid #ddd;
        font-size: 1.1rem;
        color: #003366;
    }

    #full-leaderboard-list th {
        background-color: #6ab8d3;
        color: white;
        font-weight: bold;
        position: sticky;
        top: 0;
        z-index: 1;
    }

    #full-leaderboard-list tr:last-child td {
        border-bottom: none;
    }

    #full-leaderboard-list .player-rank {
        width: 15%;
        text-align: center;
    }

    #full-leaderboard-list .player-name-col {
        width: 60%;
    }

    #full-leaderboard-list .player-time-col {
        width: 25%;
        text-align: right;
    }

    /* Highlight the current player's row */
    #full-leaderboard-list tr.current-player {
        background-color: #ffeb3b;
        font-weight: bold;
    }

     @media (max-width: 768px) {
        #full-leaderboard-list .leaderboard-title {
            font-size: 2rem;
            margin-top: 20px;
            padding: 6px 20px;
        }
        #full-leaderboard-list th, #full-leaderboard-list td {
            padding: 8px;
            font-size: 1rem;
        }
     }

     @media (max-width: 480px) {
        #full-leaderboard-list {
            padding: 10px;
        }
        #full-leaderboard-list .leaderboard-title {
            font-size: 1.5rem;
            margin-top: 10px;
            padding: 4px 15px;
        }
         #full-leaderboard-list th, #full-leaderboard-list td {
            padding: 5px;
            font-size: 0.8rem;
        }
        #full-leaderboard-list .player-rank {
            width: 20%;
        }
        #full-leaderboard-list .player-name-col {
            width: 50%;
        }
        #full-leaderboard-list .player-time-col {
            width: 30%;
        }
     }


  </style>
</head>
<body>

  <div id="start-screen">
    <img src="start_screen_new.png" alt="Start Screen" />
    <button id="start-btn" class="menu-button" onclick="showNamePopup()"></button>
    <button id="help-btn" class="menu-button" onclick="showHelpScreen()"></button>
    <button id="leaderboard-btn" class="menu-button" onclick="showPodiumLeaderboard()"></button>
    <button id="exit-btn" class="menu-button" onclick="exitGame()"></button>
    <button id="mute-btn" onclick="muteMusic()"></button>
  </div>

  <div id="name-popup">
    <button id="close-name-popup" class="close-popup-btn">×</button>
    <h2>What's Your Name?</h2>
    <input type="text" id="name-input" placeholder="Enter your name..." maxlength="20" />
    <div id="name-error" style="color: red; margin-bottom: 10px; display: none;">Please enter your name first!</div>
    <button id="continue-btn" onclick="startGame()">Continue</button>
  </div>

  <button class="home-button" id="game-home-btn" onclick="goHome()">🏠 Home</button>
  <button class="back-button" id="podium-back-btn" onclick="closePodiumLeaderboard()">←</button>
  <button class="back-button" id="full-list-back-btn" onclick="closeFullLeaderboardList()">←</button>

  <div id="congrats-popup">
    <h2>Congratulations!</h2>
    <p id="congrats-message"></p>
    <img src="https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExc3Y4cWY1bG5mZ2V6d3I0aHh2d3VrY2NlZ3F2eGJtYjR0eGJ4eSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmc3Q9Zw/3o7TKMt1VNMZRZo0e4/giphy.gif" alt="Baby GIF">
    <div class="popup-buttons">
      <button onclick="closeCongratsPopup()">OK</button>
    </div>
  </div>

  <div id="help-screen" class="help-screen">
    <img id="help-img" src="HELP.png" alt="help img">
    <button id="close-help" onclick="closeHelpScreen()"></button>
  </div>

  <div id="podium-leaderboard-page" class="leaderboard-page">
    <div class="leaderboard-container">
      <h1 class="leaderboard-title">LEADERBOARD</h1>

      <div class="podium-container">
        <div class="podium-position" id="position-2">
          <div class="player-info">
            <div class="player-name" id="name-2">-</div>
            <div class="player-time" id="time-2">-</div>
          </div>
          <div class="podium-block second-place">
            <div class="position-number">2</div> </div>
        </div>

        <div class="podium-position" id="position-1">
            <div class="player-info">
              <div class="player-name" id="name-1">-</div>
              <div class="player-time" id="time-1">-</div>
            </div>
            <div class="podium-block first-place">
               <div class="position-number">1</div> </div>
          </div>

        <div class="podium-position" id="position-3">
          <div class="player-info">
            <div class="player-name" id="name-3">-</div>
            <div class="player-time" id="time-3">-</div>
          </div>
          <div class="podium-block third-place">
            <div class="position-number">3</div> </div>
        </div>
      </div>

      </div>
  </div>

    <div id="full-leaderboard-list">
        <button class="back-button" id="full-list-home-btn" onclick="goHome()">🏠 Home</button>
        
        <div class="leaderboard-content">
            <h1 class="leaderboard-title">OVERALL LEADERBOARD</h1>
            <table>
                <thead>
                    <tr>
                        <th class="player-rank">Rank</th>
                        <th class="player-name-col">Name</th>
                        <th class="player-time-col">Time</th>
                    </tr>
                </thead>
                <tbody id="leaderboard-table-body">
                    </tbody>
            </table>
        </div>
    </div>

    <img id="baby-after-img" src="baby_after.png" alt="Baby after delivery">


  <div id="curtain"></div>

  <script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCiFbl6k3WqVcHkTq8va11Rcd8Be0vp-zU",
      authDomain: "game-leaderboard-8cb09.firebaseapp.com",
      databaseURL: "https://game-leaderboard-8cb09-default-rtdb.firebaseio.com",
      projectId: "game-leaderboard-8cb09",
      storageBucket: "game-leaderboard-8cb09.firebasestorage.app",
      messagingSenderId: "156513872664",
      appId: "1:156513872664:web:655c478a359ef94ca08c6d"
    };

    // Initialize Firebase using the compat libraries
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // Function to save score to Firebase (called automatically now)
    function saveScore() {
      const timeTaken = ((gameEndTime - gameStartTime)/1000).toFixed(1);

      if (!playerName || !timeTaken || parseFloat(timeTaken) <= 0) {
        console.log("Score not saved: Missing player name or invalid time.");
        return;
      }

      // Create a new score entry
      const scoresRef = database.ref('scores');
      const newScoreRef = scoresRef.push();

      newScoreRef.set({
        name: playerName,
        time: parseFloat(timeTaken),
        timestamp: firebase.database.ServerValue.TIMESTAMP
      })
      .then(() => {
        console.log("Score saved successfully!");
      })
      .catch((error) => {
        console.error("Error saving score: ", error);
      });
    }

    // Function to update the podium leaderboard with top 3 data from Firebase
    function updatePodiumLeaderboard() {
      const scoresRef = database.ref('scores');

      scoresRef.orderByChild('time')
        .limitToFirst(3)
        .once('value')
        .then((snapshot) => {
          console.log("Fetched podium leaderboard data");

          // Convert to array and sort by time
          const scores = [];
          snapshot.forEach((childSnapshot) => {
            scores.push({
              key: childSnapshot.key,
              ...childSnapshot.val()
            });
          });

          scores.sort((a, b) => a.time - b.time);

          for (let i = 1; i <= 3; i++) {
              const posElement = document.getElementById(`position-${i}`);
              if(posElement) posElement.classList.remove('highlight');
          }

          // Update the UI with the top 3 players
          for (let i = 0; i < 3; i++) {
            const position = i + 1;
            const playerData = scores[i];

            const nameElement = document.getElementById(`name-${position}`);
            const timeElement = document.getElementById(`time-${position}`);
            const posElement = document.getElementById(`position-${position}`);

            if (playerData && nameElement && timeElement && posElement) {
              // Format time as seconds with one decimal place
              const formattedTime = playerData.time.toFixed(1) + "s";

              // Update the player's name and time
              nameElement.textContent = playerData.name;
              timeElement.textContent = formattedTime;

              // Add special animation for this player's position
              posElement.classList.add('highlight');
            } else {
              // No player for this position or elements not found
              if(nameElement) nameElement.textContent = "-";
              if(timeElement) timeElement.textContent = "-";
            }
          }
        })
        .catch((error) => {
          console.error("Error fetching podium leaderboard data:", error);
        });
    }

    // New function to fetch and display the full leaderboard list
    function showFullLeaderboardList() {
        const fullLeaderboardDiv = document.getElementById('full-leaderboard-list');
        const leaderboardTableBody = document.getElementById('leaderboard-table-body');
        const fullListBackButton = document.getElementById('full-list-home-btn');

        // Hide other screens
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('podium-leaderboard-page').style.display = 'none';
        document.getElementById('game-home-btn').style.display = 'none';
        document.getElementById('podium-back-btn').style.display = 'none';
        document.getElementById('baby-after-img').style.display = 'none';

        // Show the full list screen
        fullLeaderboardDiv.style.display = 'flex';
        // Delay adding active class for animation
        setTimeout(() => {
            fullLeaderboardDiv.classList.add('active');
            fullListBackButton.style.display = 'flex';
        }, 10);


        // Fetch all scores ordered by time
        const scoresRef = database.ref('scores');
        scoresRef.orderByChild('time')
            .once('value')
            .then((snapshot) => {
                console.log("Fetched full leaderboard data");

                const scores = [];
                snapshot.forEach((childSnapshot) => {
                    scores.push({
                        key: childSnapshot.key,
                        ...childSnapshot.val()
                    });
                });

                scores.sort((a, b) => a.time - b.time);

                // Clear existing table body
                leaderboardTableBody.innerHTML = '';

                // Populate the table
                scores.forEach((score, index) => {
                    const row = leaderboardTableBody.insertRow();
                    row.classList.add('leaderboard-entry');

                    // Add highlight class if this is the current player
                    if (score.name === playerName && score.time.toFixed(1) === timeTaken) {
                         row.classList.add('current-player');
                    }

                    const rankCell = row.insertCell(0);
                    const nameCell = row.insertCell(1);
                    const timeCell = row.insertCell(2);

                    rankCell.classList.add('player-rank');
                    nameCell.classList.add('player-name-col');
                    timeCell.classList.add('player-time-col');


                    rankCell.textContent = index + 1;
                    nameCell.textContent = score.name;
                    timeCell.textContent = score.time.toFixed(1) + "s";
                });
            })
            .catch((error) => {
                console.error("Error fetching full leaderboard data:", error);
                leaderboardTableBody.innerHTML = '<tr><td colspan="3">Error loading leaderboard.</td></tr>';
            });
    }


    // Game Variables
    let mic, started = false;
    let screamPower = 0;
    let screamGoal = 10;
    let babyDelivered = false;
    let babyY = 0;
    let babyRiseSpeed = 30;

    let bgMusic, introMusic;
    let confettiPlayed = false;
    let playerName = "";
    let congratsShown = false;
    let babyBounce = 0;
    let babyBounceDirection = 1;
    let lastVolume = 0;
    let babyStartY = 0;
    let babyTargetY = 0;
    let babyProgress = 0;
    let legSpread = 0;
    let gameStartTime = 0;
    let gameEndTime = 0;
    let rightLegImg, leftLegImg, tummyImg, blanketImg, babyImg, bgImg, babyAfterImg;
    let cryingBabySound;
    let isMuted = false;
    let timeTaken = 0;

    function preload() {
      soundFormats('mp3', 'ogg');
      bgMusic = loadSound('background.mp3',
        () => console.log("Background music loaded"),
        () => console.log("Failed to load background music")
      );
      introMusic = loadSound('bgsong_before_maingame.mp3',
        () => console.log("Intro music loaded"),
        () => console.log("Failed to load intro music")
      );
      cryingBabySound = loadSound('crying_baby.mp3',
        () => console.log("Crying baby sound loaded"),
        () => console.log("Failed to load crying baby sound")
      );

      // Load all images with success/error callbacks
      rightLegImg = loadImage('right leg.png',
        () => console.log("Right leg image loaded"),
        () => console.log("Failed to load right leg image")
      );
      leftLegImg = loadImage('left leg.png',
        () => console.log("Left leg image loaded"),
        () => console.log("Failed to load left leg image")
      );
      tummyImg = loadImage('tummy.png',
        () => console.log("Tummy image loaded"),
        () => console.log("Failed to load tummy image")
      );
      blanketImg = loadImage('blanket.png',
        () => console.log("Blanket image loaded"),
        () => console.log("Failed to load blanket image")
      );
      babyImg = loadImage('baby.png',
        () => console.log("Baby image loaded"),
        () => console.log("Failed to load baby image")
      );
      bgImg = loadImage('bg_main_game.png',
        () => console.log("Background image loaded"),
        () => console.log("Failed to load background image")
      );
      babyAfterImg = loadImage('baby_after.png',
        () => console.log("Baby after image loaded"),
        () => console.log("Failed to load baby after image")
      );
    }

    function setup() {
      console.log("Setting up game...");
      let canvas = createCanvas(windowWidth, windowHeight);
      canvas.style('display', 'block');
      textAlign(CENTER, CENTER);
      textSize(22);

      document.getElementById('name-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') startGame();
      });

      // Set initial baby positions based on image sizes and screen size
      // These are relative to the bottom of the canvas
      babyStartY = height * 0.75;
      babyTargetY = height * 0.4;

      babyY = babyStartY;

      adjustButtonPositions();
      lockOrientation();

      console.log("Setup complete");
      console.log(`Window dimensions: ${windowWidth} x ${windowHeight}`);
      console.log(`Baby start position: ${babyStartY}, target position: ${babyTargetY}`);
      console.log(`Scream goal: ${screamGoal}`);
    }

    function lockOrientation() {
      // Try to lock the screen orientation to landscape
      if (screen.orientation && screen.orientation.lock) {
        screen.orientation.lock('landscape').catch(function(error) {
          console.log('Orientation lock failed: ', error);
        });
      } else if (window.screen.lockOrientation) {
        window.screen.lockOrientation('landscape');
      } else if (window.screen.mozLockOrientation) {
        window.screen.mozLockOrientation('landscape');
      } else if (window.screen.msLockOrientation) {
        window.screen.msLockOrientation('landscape');
      }
    }

    function draw() {
    // Draw background image
    image(bgImg, 0, 0, width, height);

    if (!started) return;

    let vol = mic ? mic.getLevel() : 0;
    let threshold = 0.50; //range level
    vol = lerp(lastVolume, vol, 0.3);
    lastVolume = vol;

    if (!babyDelivered) {
      if (vol > threshold) {
        screamPower += vol * 1.2;
        screamPower = constrain(screamPower, 0, screamGoal);
      } else {
        screamPower = lerp(screamPower, 0, 0.01);
      }
      legSpread = map(screamPower, 0, screamGoal, 0, 80);
    }


    // Draw UI elements
    fill(0);
    textSize(windowWidth > windowHeight ? 18 : 14);
    textAlign(CENTER, TOP);
    text(`Volume: ${vol.toFixed(2)}`, width / 2, 10);

    // Progress bar
    noStroke();
    fill('#8ac9db');
    rect(width / 2 - 100, 35, (screamPower / screamGoal) * 200, 20, 10);
    stroke(0);
    noFill();
    rect(width / 2 - 100, 35, 200, 20, 10);


    if (started && !babyDelivered) {
      // Calculate time components
      const elapsed = millis() - gameStartTime;
      const totalSeconds = Math.floor(elapsed / 1000);
      const seconds = totalSeconds % 60;
      const minutes = Math.floor(totalSeconds / 60) % 60;
      const hours = Math.floor(totalSeconds / 3600);

      // Format as 00:00:00
      const formattedTime = [
        hours.toString().padStart(2, '0'),
        minutes.toString().padStart(2, '0'),
        seconds.toString().padStart(2, '0')
      ].join(':');

      const timerY = 65;
      const shadowY = timerY + 2;

      // Stylish text display
      fill(255);
      stroke(0);
      strokeWeight(2);
      textSize(windowWidth > windowHeight ? 24 : 20);
      textFont('Comic Neue');
      textAlign(CENTER, TOP);

      // Draw text shadow
      fill(0, 0, 0, 100);
      noStroke();
      text(formattedTime, width/2 + 2, shadowY);

      // Draw main text
      fill(30, 144, 255, 130);
      text(formattedTime, width/2, timerY);

      // Reset styles
      noStroke();
    }

    let legWidth = width * 0.5;
    let legHeight = legWidth * (leftLegImg.height/leftLegImg.width);

    let tummyWidth = width * 0.8;
    let tummyHeight = tummyWidth * (tummyImg.height/tummyImg.width);

    let babyWidth = width * 0.2;
    let babyHeight = babyWidth * (babyImg.height/babyImg.width);

    let blanketWidth = width * 1.4;
    let blanketHeight = blanketWidth * (blanketImg.height/blanketImg.width);

    // Calculate the top Y position of the tummy area (this is for reference)
    let tummyTopY = height - tummyHeight * 0.7;


    image(leftLegImg,
        width/2 - legWidth - legSpread/2,
        height - legHeight * 0.8,
        legWidth,
        legHeight);

    image(rightLegImg,
        width/2 + legSpread/2,
        height - legHeight * 0.8,
        legWidth,
        legHeight);

    if (!babyDelivered) {
        let babyHiddenDrawY = height - babyHeight * 0.1;
        let babyEmergedDrawY = tummyTopY - babyHeight * 0.8;

        let babyDrawY = map(screamPower, 0, screamGoal, babyHiddenDrawY, babyEmergedDrawY);

      image(babyImg,
          width/2 - babyWidth/2,
          babyDrawY,
          babyWidth,
          babyHeight);
    }

    image(tummyImg,
        width/2 - tummyWidth/2,
        height - tummyHeight,
        tummyWidth,
        tummyHeight);


    image(blanketImg,
        width/2 - blanketWidth/2,
        height/2 - blanketHeight/2,
        blanketWidth,
        blanketHeight);

    // Baby delivery logic
    if (screamPower >= screamGoal) {
      if (!babyDelivered) {
          babyDelivered = true;
          gameEndTime = millis();
          timeTaken = ((gameEndTime - gameStartTime) / 1000).toFixed(1);
          saveScore();
      }

      babyProgress = min(babyProgress + 0.01, 1);

      let finalBabyBaseY = tummyTopY - babyHeight * 0.8;

      if (babyProgress >= 1) {
        babyBounce += 0.1 * babyBounceDirection;
        if (abs(babyBounce) > 5) babyBounceDirection *= -1;
      }


      image(babyImg,
            width/2 - babyWidth/2,
            finalBabyBaseY + babyBounce,
            babyWidth,
            babyHeight);


      if (!confettiPlayed && babyProgress > 0.5) {
        launchConfetti();
        confettiPlayed = true;
      }

      if (!congratsShown && babyProgress >= 1) {
        showCongratsPopup();
        congratsShown = true;
      }
    }

      // Crying sound logic (plays if game started and baby not delivered)
      if (started && !babyDelivered) {
          if (cryingBabySound && !cryingBabySound.isPlaying()) {
              cryingBabySound.loop();
              cryingBabySound.setVolume(isMuted ? 0 : 0.5);
          }
      } else if (started && babyDelivered) {
          if (cryingBabySound && cryingBabySound.isPlaying()) {
              cryingBabySound.stop();
          }
      }
 }

    function launchConfetti() {
      confetti({
        particleCount: 150,
        spread: 100,
        origin: { x: 0, y: 0.5 },
        angle: 45,
        colors: ['#f72585', '#b5179e', '#7209b7', '#3a0ca3', '#4361ee', '#4cc9f0'],
        scalar: 1.2,
        duration: 5000
      });

      confetti({
        particleCount: 150,
        spread: 100,
        origin: { x: 1, y: 0.5 },
        angle: 135,
        colors: ['#f72585', '#b5179e', '#7209b7', '#3a0ca3', '#4361ee', '#4cc9f0'],
        scalar: 1.2,
        duration: 5000
      });
    }

    function showCongratsPopup() {
      setTimeout(() => {
        const timeTaken = ((gameEndTime - gameStartTime)/1000).toFixed(1);
        const message = playerName ?
          `${playerName}, you delivered the baby in ${timeTaken} seconds!` :
          `You delivered the baby in ${timeTaken} seconds!`;
        document.getElementById('congrats-message').textContent = message;
        document.getElementById('congrats-popup').style.display = 'flex';

        // Show and position the baby after image
        const congratsPopup = document.getElementById('congrats-popup');
        const babyAfterImgElement = document.getElementById('baby-after-img');
        babyAfterImgElement.style.display = 'block';

        // Position the baby after image next to the popup
        // Get the popup's position and dimensions
        const popupRect = congratsPopup.getBoundingClientRect();
        // Position the baby image to the right of the popup
        babyAfterImgElement.style.left = `${popupRect.right + 20}px`;
        babyAfterImgElement.style.top = `${popupRect.top + popupRect.height / 2}px`;
        babyAfterImgElement.style.transform = 'translateY(-50%)';


        document.getElementById('congrats-popup').style.animation = 'bounceIn 0.5s';
      }, 2000);
    }

    function closeCongratsPopup() {
      document.getElementById('congrats-popup').style.display = 'none';
      document.getElementById('baby-after-img').style.display = 'none';
      showFullLeaderboardList();
    }

    function showNamePopup() {
      document.getElementById('start-screen').style.display = 'none';
      document.getElementById('name-popup').style.display = 'flex';
      document.getElementById('name-input').value = '';
      document.getElementById('name-error').style.display = 'none';
      document.getElementById('name-input').focus();
    }

    function startGame() {
      const nameInput = document.getElementById('name-input');
      const errorMessage = document.getElementById('name-error');

      playerName = nameInput.value.trim();

      if (playerName === "") {
        errorMessage.style.display = 'block';
        nameInput.style.animation = 'shake 0.5s';
        setTimeout(() => {
          nameInput.style.animation = '';
        }, 500);
        return;
      }

      errorMessage.style.display = 'none';
      document.getElementById('name-popup').style.display = 'none';

      const curtain = document.getElementById('curtain');
      curtain.style.display = 'block';
      curtain.classList.add('close-curtain');

      document.getElementById('start-screen').style.display = 'none';

      setTimeout(() => {
        document.getElementById('game-home-btn').style.display = 'block';
        curtain.classList.remove('close-curtain');
        curtain.style.display = 'none';

        stopIntroMusic();
        playBackgroundMusic();

        // Initialize microphone
        mic = new p5.AudioIn();
        mic.start(() => {
          console.log("Microphone started successfully");
        }, () => {
          alert("Please allow microphone access!");
          console.error("Failed to start microphone");
        });
        userStartAudio();

        // Reset game state
        started = true;
        screamPower = 0;
        babyDelivered = false;
        confettiPlayed = false;
        congratsShown = false;
        babyProgress = 0;
        // Recalculate initial baby positions based on current window size
        babyStartY = height * 0.75;
        babyTargetY = height * 0.4;
        babyY = babyStartY;

        legSpread = 0;
        gameStartTime = millis();
        gameEndTime = 0;
        timeTaken = 0;
        document.getElementById('baby-after-img').style.display = 'none';


        console.log("Game started!");
        console.log(`Player name: ${playerName}`);
        console.log(`Game start time: ${gameStartTime}`);
      }, 1500);
    }

    function muteMusic() {
      isMuted = !isMuted;
      console.log(`Mute toggled: ${isMuted}`);

      const muteButton = document.getElementById('mute-btn');

      if (isMuted) {
        if (introMusic && introMusic.isPlaying()) {
          introMusic.setVolume(0);
        }
        if (bgMusic && bgMusic.isPlaying()) {
          bgMusic.setVolume(0);
        }
        if (cryingBabySound && cryingBabySound.isPlaying()) {
          cryingBabySound.setVolume(0);
        }
        muteButton.classList.add('muted');
      } else {
        if (introMusic && introMusic.isPlaying()) {
          introMusic.setVolume(0.3);
        }
        if (bgMusic && bgMusic.isPlaying()) {
          bgMusic.loop();
          bgMusic.setVolume(0.3);
        }
        if (cryingBabySound && cryingBabySound.isPlaying()) {
          cryingBabySound.setVolume(0.5);
        }
        muteButton.classList.remove('muted');
      }
    }

    function goHome() {
        const curtain = document.getElementById('curtain');
        curtain.style.display = 'block';
        curtain.classList.add('close-curtain');

        setTimeout(() => {
            started = false;
            screamPower = 0;
            babyDelivered = false;
            confettiPlayed = false;
            congratsShown = false;
            playerName = "";

            if (mic) {
              mic.stop();
              mic = null;
              console.log("Microphone stopped.");
            }

            if (cryingBabySound && cryingBabySound.isPlaying()) {
              cryingBabySound.stop();
            }

            document.getElementById('congrats-popup').style.display = 'none';
            document.getElementById('start-screen').style.display = 'flex';
            document.getElementById('game-home-btn').style.display = 'none';
            document.getElementById('podium-leaderboard-page').classList.remove('active');
            document.getElementById('podium-leaderboard-page').style.display = 'none';
            document.getElementById('podium-back-btn').style.display = 'none';
            document.getElementById('full-leaderboard-list').classList.remove('active');
            document.getElementById('full-leaderboard-list').style.display = 'none';
            document.getElementById('full-list-home-btn').style.display = 'none';
            document.getElementById('baby-after-img').style.display = 'none';


            if (bgMusic && bgMusic.isPlaying()) {
              bgMusic.stop();
            }
            playIntroMusic();

            // Reset baby position and animation state
            babyStartY = height * 0.75;
            babyTargetY = height * 0.4;
            babyY = babyStartY;
            babyProgress = 0;
            legSpread = 0;
            babyBounce = 0;
            babyBounceDirection = 1;
            gameStartTime = 0;
            gameEndTime = 0;
            timeTaken = 0;

            curtain.classList.remove('close-curtain');
            curtain.style.display = 'none';

            console.log("Returned to home screen");
        }, 1500);
    }

    function showHelpScreen() {
      const helpScreen = document.getElementById('help-screen');
      helpScreen.style.display = 'flex';
      setTimeout(() => {
          helpScreen.classList.add('active');
      }, 10);
      console.log("Help screen opened");
    }

    function closeHelpScreen() {
      const helpScreen = document.getElementById('help-screen');
      helpScreen.classList.remove('active');
      setTimeout(() => {
          helpScreen.style.display = 'none';
      }, 300);
      console.log("Help screen closed");
    }

    function closeNamePopup() {
      document.getElementById('name-popup').style.display = 'none';
      document.getElementById('start-screen').style.display = 'flex';
      console.log("Name popup closed");
    }

    // Renamed function to show Podium Leaderboard
    function showPodiumLeaderboard() {
      const leaderboard = document.getElementById('podium-leaderboard-page');
      const backButton = document.getElementById('podium-back-btn');

      // Hide other screens
      document.getElementById('start-screen').style.display = 'none';
      document.getElementById('full-leaderboard-list').classList.remove('active');
      document.getElementById('full-leaderboard-list').style.display = 'none';
      document.getElementById('full-list-home-btn').style.display = 'none';
      document.getElementById('game-home-btn').style.display = 'none';
      document.getElementById('baby-after-img').style.display = 'none';


      leaderboard.style.display = 'flex';
        setTimeout(() => {
           backButton.style.display = 'flex';
        }, 100);


      updatePodiumLeaderboard(); // Call the podium update function

      setTimeout(() => {
        leaderboard.classList.add('active');
      }, 10);
      console.log("Podium Leaderboard opened");
    }

    function closePodiumLeaderboard() {
      const leaderboard = document.getElementById('podium-leaderboard-page');
      const backButton = document.getElementById('podium-back-btn');

      leaderboard.classList.remove('active');

      setTimeout(() => {
            backButton.style.display = 'none';
            leaderboard.style.display = 'none';
            document.getElementById('start-screen').style.display = 'flex';
      }, 300);
      console.log("Podium Leaderboard closed");
    }

    function closeFullLeaderboardList() {
        const fullLeaderboardDiv = document.getElementById('full-leaderboard-list');
        const fullListHomeButton = document.getElementById('full-list-home-btn');

        fullLeaderboardDiv.classList.remove('active');

        setTimeout(() => {
            fullListHomeButton.style.display = 'none';
            fullLeaderboardDiv.style.display = 'none';
            document.getElementById('start-screen').style.display = 'flex';
        }, 300);
        console.log("Full Leaderboard List closed");
    }


    function exitGame() {
      alert("Thanks for playing! The game would exit here in a native app.");
      console.log("Exit game clicked");
    }

    function playIntroMusic() {
      if (introMusic && !introMusic.isPlaying()) {
        introMusic.loop();
        introMusic.setVolume(isMuted ? 0 : 0.3);
        console.log("Intro music started");
      }
    }

    function stopIntroMusic() {
      if (introMusic && introMusic.isPlaying()) {
        introMusic.stop();
        console.log("Intro music stopped");
      }
    }

    function playBackgroundMusic() {
      if (bgMusic && !bgMusic.isPlaying()) {
        bgMusic.loop();
        bgMusic.setVolume(isMuted ? 0 : 0.3);
        console.log("Background music started");
      }
    }

    function adjustButtonPositions() {
      // These values should be adjusted based on your start_screen_new.png layout
      if (windowWidth > windowHeight) {
        /* Existing landscape adjustments */
      } else {
        /* Existing portrait adjustments */
      }
      console.log("Button positions adjusted");
    }

    function windowResized() {
      // Resize the p5.js canvas to the new window dimensions
      resizeCanvas(windowWidth, windowHeight);

      // Recalculate positions that depend on canvas height/width
      // These are relative to the bottom of the canvas, adjusted for resize
      babyStartY = height * 0.75;
      babyTargetY = height * 0.4;

      if (babyDelivered) {
        babyY = babyTargetY;
      } else if (started) {

          babyY = lerp(babyStartY, babyTargetY, screamPower/screamGoal);
      } else {
        // If game hasn't started, reset babyY to start position relative to new screen height
        babyY = babyStartY;
      }


      // Adjust button positions for the new window size
      adjustButtonPositions();

      // Re-position the baby after image if it's visible
      const congratsPopup = document.getElementById('congrats-popup');
      const babyAfterImgElement = document.getElementById('baby-after-img');
      if (babyAfterImgElement.style.display !== 'none') {
         const popupRect = congratsPopup.getBoundingClientRect();
         babyAfterImgElement.style.left = `${popupRect.right + 20}px`;
         babyAfterImgElement.style.top = `${popupRect.top + popupRect.height / 2}px`;
         babyAfterImgElement.style.transform = 'translateY(-50%)';
      }


      console.log(`Window resized: ${windowWidth} x ${windowHeight}`);
    }

    function handleFirstInteraction() {
      userStartAudio();
      playIntroMusic();
      window.removeEventListener('click', handleFirstInteraction);
      window.removeEventListener('touchstart', handleFirstInteraction);
      console.log("First interaction handled");
    }

    // Add event listeners
    document.addEventListener('DOMContentLoaded', function() {
      console.log("DOM content loaded");

      // Set up close button event listener
      document.getElementById('close-name-popup').addEventListener('click', closeNamePopup);

      // Initial window resize to set positions
      windowResized();
    });

    window.addEventListener('load', function() {
      console.log("Window loaded");
      // Music will start on first user interaction (click/touch)
    });

    window.addEventListener('resize', windowResized);
    window.addEventListener('click', handleFirstInteraction);
    window.addEventListener('touchstart', handleFirstInteraction);

  </script>
</body>
</html>