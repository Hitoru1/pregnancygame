<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="HandheldFriendly" content="true">
  <!-- Lock orientation to landscape -->
  <meta name="screen-orientation" content="landscape">
  <meta name="full-screen" content="yes">
  <meta name="x5-fullscreen" content="true">
  <meta name="x5-orientation" content="landscape">
  <title>Scream to Deliver</title>

  <!-- External Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/addons/p5.sound.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <!-- Cartoon Font -->
  <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&display=swap" rel="stylesheet">

  <style>
    * {
      box-sizing: border-box;
      touch-action: manipulation;
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      overflow: hidden;
      font-family: 'Comic Neue', cursive;
      background: linear-gradient(to bottom, #c0e6f0, #a7cde2);
    }

    /* Force landscape orientation */
    @media screen and (orientation:portrait) {
      body {
        transform: rotate(90deg);
        transform-origin: left top;
        width: 100vh;
        height: 100vw;
        overflow-x: hidden;
        position: absolute;
        top: 100%;
        left: 0;
      }
    }

    #start-screen {
      position: absolute;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 10;
      animation: fadeIn 0.6s ease-in-out;
    }

    #start-screen img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      position: absolute;
      top: 0;
      left: 0;
      z-index: -1;
    }

    .menu-button {
   position: absolute;
   
   background: transparent; 
   border: none;           
   
   cursor: pointer;
   z-index: 11;
   transition: background 0.3s;
   padding: 0;
   margin: 0;
   overflow: hidden;
   text-indent: -9999px;
 }

 
 .menu-button:hover {
   
    background: transparent;

   
   background: rgba(255, 255, 255, 0.1); 
 }

 
 #start-btn { 
   width: 40%;
   height: 45%;
   top: 2%;
   left: 1%;
 }

 #help-btn { 
   width: 17%;
   height: 12%;
   top: 28%;
   left: 41%;
 }

 #leaderboard-btn { 
   width: 33%;
   height: 16%;
   top: 7%;
   left: 58%;
 }

 #exit-btn { 
   width: 28%;
   height: 18%;
   top: 75%;
   left: 68%;
 }
    .home-button {
      position: absolute;
      top: 2vw;
      right: 2vw;
      background-color:#6ab8d3;
      color: white;
      font-size: 4vw;
      padding: 1.5vw 3vw;
      border-radius: 15px;
      border: none;
      box-shadow: 2px 2px 10px rgba(0,0,0,0.2);
      display: none;
      z-index: 20;
      cursor: pointer;
      font-family: 'Comic Neue', cursive;
    }

    /* Name Input Popup Styles */
    #name-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(to bottom, #a7cde2, #8ac9db);
      padding: 20px;
      border-radius: 20px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      z-index: 100;
      display: none;
      flex-direction: column;
      align-items: center;
      border: 4px solid #6ab8d3;
      animation: bounceIn 0.5s;
      max-width: 90%;
      width: 350px;
    }

    #name-popup h2 {
      color: #003366;
      margin-top: 0;
      font-size: 1.8rem;
      text-align: center;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    }

    #name-input {
      width: 100%;
      padding: 12px;
      margin: 15px 0;
      border-radius: 10px;
      border: 3px solid #6ab8d3;
      font-family: 'Comic Neue', cursive;
      font-size: 1.1rem;
      outline: none;
      transition: all 0.3s;
    }

    #name-input:focus {
      border-color: #4a99b1;
      box-shadow: 0 0 10px rgba(106, 184, 211, 0.5);
    }

    #continue-btn {
      background-color: #6ab8d3;
      border: none;
      padding: 10px 20px;
      font-size: 1.1rem;
      color: white;
      border-radius: 10px;
      cursor: pointer;
      transition: 0.3s ease;
      font-family: 'Comic Neue', cursive;
      box-shadow: 0 4px 0 #4a99b1;
      width: 100%;
    }

    #continue-btn:hover {
      background-color: #4a99b1;
      transform: translateY(2px);
      box-shadow: 0 2px 0 #3a7d91;
    }

    #continue-btn:active {
      transform: translateY(4px);
      box-shadow: none;
    }

    #name-popup::before {
      content: '';
      position: absolute;
      top: -10px;
      left: -10px;
      right: -10px;
      bottom: -10px;
      border-radius: 25px;
      border: 2px dashed #6ab8d3;
      z-index: -1;
      pointer-events: none;
    }

    /* Congratulations Popup */
    #congrats-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(to bottom, #a7cde2, #8ac9db);
      padding: 20px;
      border-radius: 20px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      z-index: 100;
      display: none;
      flex-direction: column;
      align-items: center;
      border: 4px solid #6ab8d3;
      animation: bounceIn 0.5s;
      max-width: 90%;
      width: 350px;
      text-align: center;
    }

    #congrats-popup h2 {
      color: #003366;
      margin-top: 0;
      font-size: 1.8rem;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    }

    #congrats-popup p {
      font-size: 1.1rem;
      margin-bottom: 15px;
    }

    #congrats-popup img {
      width: 130px;
      height: auto;
      margin: 0 auto 15px;
      display: block;
    }

    #congrats-popup button {
      background-color: #6ab8d3;
      border: none;
      padding: 8px 16px;
      font-size: 1rem;
      color: white;
      border-radius: 10px;
      cursor: pointer;
      transition: 0.3s ease;
      font-family: 'Comic Neue', cursive;
    }

    #congrats-popup button:hover {
      background-color: #4a99b1;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideIn {
      from {
        transform: translateY(-100px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    @keyframes bounceIn {
      0% {
        transform: translate(-50%, -50%) scale(0.8);
        opacity: 0;
      }
      50% {
        transform: translate(-50%, -50%) scale(1.05);
      }
      100% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
      }
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      20%, 60% { transform: translateX(-5px); }
      40%, 80% { transform: translateX(5px); }
    }

    /* Curtain Effect */
    #curtain {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 15;
      display: none;
    }

    #curtain::before, #curtain::after {
      content: '';
      position: absolute;
      top: 0;
      width: 50%;
      height: 100%;
      background: linear-gradient(to bottom, #6ab8d3, #a7cde2);
      z-index: 15;
    }

    #curtain::before {
      left: 0;
    }

    #curtain::after {
      right: 0;
    }

    .close-curtain::before {
      animation: curtainLeft 1.5s forwards;
    }

    .close-curtain::after {
      animation: curtainRight 1.5s forwards;
    }

    @keyframes curtainLeft {
      0% { transform: translateX(0); }
      100% { transform: translateX(-100%); }
    }

    @keyframes curtainRight {
      0% { transform: translateX(0); }
      100% { transform: translateX(100%); }
    }

    canvas {
      display: block;
      position: absolute;
      top: 0;
      left: 0;
      z-index: 1;
    }

    /* Help Screen */
    #help-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 100;
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: white;
      text-align: center;
      padding: 15px;
    }

    #help-screen h2 {
      font-size: 1.8rem;
      margin-bottom: 15px;
    }

    #help-screen p {
      font-size: 1.1rem;
      margin-bottom: 25px;
      max-width: 90%;
    }

    #close-help {
      background-color: #6ab8d3;
      border: none;
      padding: 10px 20px;
      font-size: 1.1rem;
      color: white;
      border-radius: 10px;
      cursor: pointer;
    }

    /* Leaderboard Screen */
    #leaderboard-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 100;
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: white;
      text-align: center;
      padding: 15px;
    }

    #leaderboard-screen h2 {
      font-size: 1.8rem;
      margin-bottom: 15px;
    }

    #leaderboard-list {
      font-size: 1.1rem;
      margin-bottom: 25px;
      max-width: 90%;
      text-align: left;
    }

    #close-leaderboard {
      background-color: #6ab8d3;
      border: none;
      padding: 10px 20px;
      font-size: 1.1rem;
      color: white;
      border-radius: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <!-- Start Screen -->
  <div id="start-screen">
    <img src="start_screen_new.png" alt="Start Screen" />
    <button id="start-btn" class="menu-button" onclick="showNamePopup()"></button>
    <button id="help-btn" class="menu-button" onclick="showHelpScreen()"></button>
    <button id="leaderboard-btn" class="menu-button" onclick="showLeaderboard()"></button>
    <button id="exit-btn" class="menu-button" onclick="exitGame()"></button>
  </div>

  <!-- Name Input Popup -->
  <div id="name-popup">
    <h2>What's Your Name?</h2>
    <input type="text" id="name-input" placeholder="Enter your name..." maxlength="20" />
    <div id="name-error" style="color: red; margin-bottom: 10px; display: none;">Please enter your name first!</div>
    <button id="continue-btn" onclick="startGame()">Continue</button>
  </div>

  <!-- Home Button (shown during game) -->
  <button class="home-button" id="home-btn" onclick="goHome()">üè† Home</button>

  <!-- Congratulations Popup -->
  <div id="congrats-popup">
    <h2>Congratulations!</h2>
    <p id="congrats-message"></p>
    <img src="https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExc3Y4cWY1bG5mZ2V6d3I0aHh2d3VrY2NlZ3F2eGJtYjR0eGJ4eSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/3o7TKMt1VNMZRZo0e4/giphy.gif" alt="Baby GIF">
    <button onclick="closeCongratsPopup()">OK</button>
  </div>

  <!-- Help Screen -->
  <div id="help-screen">
    <h2>How to Play</h2>
    <p>Scream as loud as you can to help the mother deliver her baby! The louder you scream, the faster the baby will come out. Keep screaming until the baby is fully delivered!</p>
    <button id="close-help" onclick="closeHelpScreen()">Got it!</button>
  </div>

  <!-- Leaderboard Screen -->
  <div id="leaderboard-screen">
    <h2>Leaderboard</h2>
    <div id="leaderboard-list">
      <!-- Leaderboard entries will be added here -->
      <p>1. Player 1 - 10 seconds</p>
      <p>2. Player 2 - 12 seconds</p>
      <p>3. Player 3 - 15 seconds</p>
    </div>
    <button id="close-leaderboard" onclick="closeLeaderboard()">Close</button>
  </div>

  <!-- Curtain Element -->
  <div id="curtain"></div>

  <script>
    let mic, started = false;
    let screamPower = 0, screamGoal = 10, babyDelivered = false;
    let babyY = 320, babyRiseSpeed = 1.5;
    let doctorBlinkTimer = 0, doctorEyesClosed = false;
    let bgMusic, introMusic;
    let confettiPlayed = false;
    let playerName = "";
    let congratsShown = false;
    let momMouthOpen = false;
    let momMouthTimer = 0;
    let babyBounce = 0;
    let babyBounceDirection = 1;
    let lastVolume = 0;
    let babyStartY = 0;
    let babyTargetY = 0;
    let babyProgress = 0;
    let legSpread = 0;
    let gameStartTime = 0;
    let gameEndTime = 0;

    function preload() {
      soundFormats('mp3', 'ogg');
      bgMusic = loadSound('background.mp3', () => {}, () => {});
      introMusic = loadSound('bgsong_before_maingame.mp3', () => {}, () => {});
    }

    function setup() {
      // Create canvas that fits the window but maintains aspect ratio
      let canvas = createCanvas(windowWidth, windowHeight);
      canvas.style('display', 'block');
      textAlign(CENTER, CENTER);
      textSize(22);
      
      document.getElementById('name-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          startGame();
        }
      });
      
      babyStartY = height * 0.75 + 50;
      babyTargetY = height / 2;
      babyY = babyStartY;
      
      // Adjust button positions initially
      adjustButtonPositions();
      
      // Force landscape orientation on mobile devices
      lockOrientation();
    }

    function lockOrientation() {
      // Try to lock the screen orientation to landscape
      if (screen.orientation && screen.orientation.lock) {
        screen.orientation.lock('landscape').catch(function(error) {
          console.log('Orientation lock failed: ', error);
        });
      } else if (window.screen.lockOrientation) {
        window.screen.lockOrientation('landscape');
      } else if (window.screen.mozLockOrientation) {
        window.screen.mozLockOrientation('landscape');
      } else if (window.screen.msLockOrientation) {
        window.screen.msLockOrientation('landscape');
      }
    }

    function draw() {
      background('#d5f2f9');
      if (!started) return;

      let vol = mic.getLevel();
      let threshold = 0.2;

      // Smooth volume changes
      vol = lerp(lastVolume, vol, 0.2);
      lastVolume = vol;

      if (!babyDelivered && vol > threshold) {
        // Make the game harder by requiring louder screams
        screamPower += vol * 0.3; // Reduced from 0.5 to make it harder
        screamPower = constrain(screamPower, 0, screamGoal);
        
        momMouthOpen = true;
        momMouthTimer = 0;
        legSpread = map(screamPower, 0, screamGoal, 0, 60);
      } else {
        momMouthTimer++;
        if (momMouthTimer > 10) {
          momMouthOpen = false;
        }
        legSpread = lerp(legSpread, 0, 0.05);
      }

      // UI Elements
      fill(0);
      textSize(windowWidth > windowHeight ? 18 : 14);
      text(`Volume: ${vol.toFixed(2)}`, width / 2, 30);

      // Progress bar
      noStroke();
      fill('#8ac9db');
      rect(width / 2 - 100, 60, (screamPower / screamGoal) * 200, 20, 10);
      stroke(0);
      noFill();
      rect(width / 2 - 100, 60, 200, 20, 10);

      // Timer display
      if (started && !babyDelivered) {
        fill(0);
        textSize(windowWidth > windowHeight ? 18 : 14);
        text(`Time: ${((millis() - gameStartTime)/1000).toFixed(1)}s`, width / 2, height - 30);
      }

      // Draw characters - now centered vertically
      drawMomBody(screamPower);
      drawDoctor();

      // Baby delivery logic
      if (screamPower >= screamGoal) {
        babyDelivered = true;
        gameEndTime = millis();
        babyProgress = min(babyProgress + 0.01, 1);
        babyY = lerp(babyStartY, babyTargetY, babyProgress);
        
        if (babyProgress >= 1) {
          babyBounce += 0.1 * babyBounceDirection;
          if (abs(babyBounce) > 5) {
            babyBounceDirection *= -1;
          }
        }
      }

      // Draw baby and handle completion
      if (babyDelivered) {
        drawBaby(babyY + babyBounce);
        if (!confettiPlayed && babyProgress > 0.5) {
          launchConfetti();
          confettiPlayed = true;
        }

        if (!congratsShown && babyProgress >= 1) {
          showCongratsPopup();
          congratsShown = true;
        }
      } else {
        fill(0);
        textSize(windowWidth > windowHeight ? 20 : 16);
        text("SCREAM LOUDER TO DELIVER THE BABY!", width / 2, height - 60);
      }

      // Doctor blinking
      doctorBlinkTimer++;
      if (doctorBlinkTimer % 120 === 0) {
        doctorEyesClosed = true;
      }
      if (doctorBlinkTimer % 125 === 0) {
        doctorEyesClosed = false;
      }
    }

    function drawDoctor() {
      // Position doctor centered at bottom with gap
      let doctorX = width / 2;
      let doctorY = height / 2 + 100 + legSpread * 0.5;
      
      // Body
      fill('#6c757d');
      rect(doctorX - 30, doctorY - 60, 60, 80, 10);
      
      // Head
      fill('#ffe5b4');
      ellipse(doctorX, doctorY - 80, 50, 50);
      
      // Hair
      fill('#333');
      arc(doctorX, doctorY - 95, 50, 30, PI, TWO_PI);
      
      // Eyes
      fill(0);
      if (doctorEyesClosed) {
        line(doctorX - 10, doctorY - 84, doctorX - 5, doctorY - 84);
        line(doctorX + 5, doctorY - 84, doctorX + 10, doctorY - 84);
      } else {
        ellipse(doctorX - 10, doctorY - 84, 6, 8);
        ellipse(doctorX + 10, doctorY - 84, 6, 8);
      }
      
      // Mouth
      noFill();
      stroke(0);
      strokeWeight(1);
      arc(doctorX, doctorY - 70, 20, 10, 0, PI);
      noStroke();
      
      // Mask
      fill(255);
      rect(doctorX - 20, doctorY - 90, 40, 20, 5);
      
      // Stethoscope
      fill('#333');
      ellipse(doctorX - 15, doctorY - 60, 10, 10);
      line(doctorX - 15, doctorY - 60, doctorX - 5, doctorY - 50);
      ellipse(doctorX - 5, doctorY - 50, 8, 8);
      
      // Hands (positioned to sides to create gap)
      fill('#ffe5b4');
      ellipse(doctorX - 40 - legSpread * 0.5, doctorY - 30, 25, 20);
      ellipse(doctorX + 40 + legSpread * 0.5, doctorY - 30, 25, 20);
    }

    function drawMomBody(power) {
      // Head - centered vertically
      fill('#ffe5b4');
      ellipse(width / 2, height / 2 - 100, 60, 60);
      
      // Hair
      fill('#654321');
      arc(width / 2, height / 2 - 115, 70, 40, PI, TWO_PI);
      
      // Eyes
      fill(0);
      line(width / 2 - 15, height / 2 - 105, width / 2 - 8, height / 2 - 105);
      line(width / 2 + 8, height / 2 - 105, width / 2 + 15, height / 2 - 105);
      
      // Mouth
      if (momMouthOpen) {
        fill('#ff6f61');
        ellipse(width / 2, height / 2 - 85, 25, 15);
      } else {
        noFill();
        stroke(0);
        strokeWeight(2);
        line(width / 2 - 10, height / 2 - 85, width / 2 + 10, height / 2 - 85);
        noStroke();
      }
      
      // Body with gap in middle
      fill('#b0e0e6');
      beginShape();
      vertex(width / 2 - 50, height / 2 - 70);
      vertex(width / 2 - 60, height / 2 - 20);
      vertex(width / 2 - 40 - legSpread, height / 2);
      vertex(width / 2 - 20 - legSpread/2, height / 2);
      vertex(width / 2 - 20 - legSpread/2, height / 2 + 20);
      vertex(width / 2 + 20 + legSpread/2, height / 2 + 20);
      vertex(width / 2 + 20 + legSpread/2, height / 2);
      vertex(width / 2 + 40 + legSpread, height / 2);
      vertex(width / 2 + 60, height / 2 - 20);
      vertex(width / 2 + 50, height / 2 - 70);
      endShape(CLOSE);
      
      // Arms
      fill('#ffe5b4');
      let armSpread = map(power, 0, screamGoal, 10, 80);
      ellipse(width / 2 - 50 - armSpread/2, height / 2 - 50, 30, 15);
      ellipse(width / 2 + 50 + armSpread/2, height / 2 - 50, 30, 15);
      
      // Legs
      fill('#ffe5b4');
      // Left leg
      beginShape();
      vertex(width / 2 - 40 - legSpread, height / 2);
      vertex(width / 2 - 30 - legSpread, height / 2 + 30);
      vertex(width / 2 - 20 - legSpread, height / 2 + 30);
      vertex(width / 2 - 30 - legSpread, height / 2);
      endShape(CLOSE);
      
      // Right leg
      beginShape();
      vertex(width / 2 + 20 + legSpread, height / 2);
      vertex(width / 2 + 30 + legSpread, height / 2 + 30);
      vertex(width / 2 + 40 + legSpread, height / 2 + 30);
      vertex(width / 2 + 30 + legSpread, height / 2);
      endShape(CLOSE);
    }

    function drawBaby(y) {
      // Body - positioned in the gap between legs
      fill('#ffe066');
      ellipse(width / 2, y, 40, 40);
      
      // Eyes
      fill(0);
      ellipse(width / 2 - 8, y - 5, 5, 5);
      ellipse(width / 2 + 8, y - 5, 5, 5);
      
      // Mouth
      noFill();
      stroke(0);
      strokeWeight(1);
      if (babyDelivered && babyProgress > 0.5) {
        arc(width / 2, y + 6, 12, 8, 0, PI);
      } else {
        line(width / 2 - 5, y + 6, width / 2 + 5, y + 6);
      }
      noStroke();
      
      // Arms
      fill('#ffe066');
      if (babyDelivered && babyProgress > 0.5) {
        let armAngle = sin(frameCount * 0.1) * 0.2;
        push();
        translate(width / 2 - 15, y - 5);
        rotate(armAngle);
        ellipse(0, 0, 15, 5);
        pop();
        
        push();
        translate(width / 2 + 15, y - 5);
        rotate(-armAngle);
        ellipse(0, 0, 15, 5);
        pop();
      } else {
        ellipse(width / 2 - 15, y - 5, 15, 5);
        ellipse(width / 2 + 15, y - 5, 15, 5);
      }
      
      // Umbilical cord
      if (babyProgress < 0.9) {
        stroke('#8b4513');
        strokeWeight(2);
        line(width / 2, y + 20, width / 2, height / 2);
        noStroke();
      }
    }

    function launchConfetti() {
      confetti({
        particleCount: 150,
        spread: 100,
        origin: { x: 0, y: 0.5 },
        angle: 45,
        colors: ['#f72585', '#b5179e', '#7209b7', '#3a0ca3', '#4361ee', '#4cc9f0'],
        scalar: 1.2,
        duration: 5000
      });

      confetti({
        particleCount: 150,
        spread: 100,
        origin: { x: 1, y: 0.5 },
        angle: 135,
        colors: ['#f72585', '#b5179e', '#7209b7', '#3a0ca3', '#4361ee', '#4cc9f0'],
        scalar: 1.2,
        duration: 5000
      });
    }

    function showCongratsPopup() {
      const timeTaken = ((gameEndTime - gameStartTime)/1000).toFixed(1);
      const message = playerName ? 
        `Congratulations ${playerName}! You delivered the baby in ${timeTaken} seconds!` : 
        `Congratulations! You delivered the baby in ${timeTaken} seconds!`;
      document.getElementById('congrats-message').textContent = message;
      document.getElementById('congrats-popup').style.display = 'flex';
    }

    function closeCongratsPopup() {
      document.getElementById('congrats-popup').style.display = 'none';
    }

    function showNamePopup() {
      document.getElementById('start-screen').style.display = 'none';
      document.getElementById('name-popup').style.display = 'flex';
      document.getElementById('name-input').value = '';
      document.getElementById('name-error').style.display = 'none';
      document.getElementById('name-input').focus();
    }

    function startGame() {
      const nameInput = document.getElementById('name-input');
      const errorMessage = document.getElementById('name-error');
      
      playerName = nameInput.value.trim();
      
      if (playerName === "") {
        errorMessage.style.display = 'block';
        nameInput.style.animation = 'shake 0.5s';
        setTimeout(() => {
          nameInput.style.animation = '';
        }, 500);
        return;
      }
      
      errorMessage.style.display = 'none';
      document.getElementById('name-popup').style.display = 'none';
      
      const curtain = document.getElementById('curtain');
      curtain.style.display = 'block';
      curtain.classList.add('close-curtain');

      document.getElementById('start-screen').style.display = 'none';

      playIntroMusic();

      setTimeout(() => {
        document.getElementById('home-btn').style.display = 'block';
        curtain.style.display = 'none';
        stopIntroMusic();
        playBackgroundMusic();

        mic = new p5.AudioIn();
        mic.start(() => {}, () => alert("Please allow microphone access!"));
        userStartAudio();

        // Reset game state
        started = true;
        screamPower = 0;
        babyDelivered = false;
        confettiPlayed = false;
        congratsShown = false;
        babyProgress = 0;
        babyY = height / 2 + 50;
        babyStartY = height / 2 + 50;
        babyTargetY = height / 2 - 50;
        legSpread = 0;
        gameStartTime = millis();
      }, 1000);
    }

    function goHome() {
      started = false;
      screamPower = 0;
      babyDelivered = false;
      confettiPlayed = false;
      congratsShown = false;
      playerName = "";
      document.getElementById('congrats-popup').style.display = 'none';
      document.getElementById('start-screen').style.display = 'flex';
      document.getElementById('home-btn').style.display = 'none';
      if (bgMusic && bgMusic.isPlaying()) {
        bgMusic.stop();
      }
      playIntroMusic();
    }

    function showHelpScreen() {
      document.getElementById('help-screen').style.display = 'flex';
    }

    function closeHelpScreen() {
      document.getElementById('help-screen').style.display = 'none';
    }

    function showLeaderboard() {
      document.getElementById('leaderboard-screen').style.display = 'flex';
    }

    function closeLeaderboard() {
      document.getElementById('leaderboard-screen').style.display = 'none';
    }

    function exitGame() {
      // In a real app, this might close the window or app
      // For web, we'll just show an alert
      alert("Thanks for playing! The game would exit here in a native app.");
    }

    function playIntroMusic() {
      if (introMusic && !introMusic.isPlaying()) {
        introMusic.loop();
        introMusic.setVolume(0.3);
      }
    }

    function stopIntroMusic() {
      if (introMusic && introMusic.isPlaying()) {
        introMusic.stop();
      }
    }

    function playBackgroundMusic() {
      if (bgMusic && !bgMusic.isPlaying()) {
        bgMusic.loop();
        bgMusic.setVolume(0.3);
      }
    }

    function adjustButtonPositions() {
      // These values should be adjusted based on your start_screen_new.png layout
      if (windowWidth > windowHeight) {
        // Landscape orientation
        document.getElementById('start-btn').style.width = '38%';
        document.getElementById('start-btn').style.height = '30%';
        document.getElementById('start-btn').style.top = '4%';
        document.getElementById('start-btn').style.left = '1%';
        
        document.getElementById('help-btn').style.width = '15%';
        document.getElementById('help-btn').style.height = '10%';
        document.getElementById('help-btn').style.top = '42%';
        document.getElementById('help-btn').style.left = '10%';
        
        document.getElementById('leaderboard-btn').style.width = '25%';
        document.getElementById('leaderboard-btn').style.height = '10%';
        document.getElementById('leaderboard-btn').style.top = '54%';
        document.getElementById('leaderboard-btn').style.left = '10%';
        
        document.getElementById('exit-btn').style.width = '15%';
        document.getElementById('exit-btn').style.height = '10%';
        document.getElementById('exit-btn').style.top = '68%';
        document.getElementById('exit-btn').style.left = '10%';
      } else {
        // Portrait orientation (will be rotated to landscape)
        document.getElementById('start-btn').style.width = '40%';
        document.getElementById('start-btn').style.height = '8%';
        document.getElementById('start-btn').style.top = '30%';
        document.getElementById('start-btn').style.left = '30%';
        
        document.getElementById('help-btn').style.width = '40%';
        document.getElementById('help-btn').style.height = '8%';
        document.getElementById('help-btn').style.top = '40%';
        document.getElementById('help-btn').style.left = '30%';
        
        document.getElementById('leaderboard-btn').style.width = '40%';
        document.getElementById('leaderboard-btn').style.height = '8%';
        document.getElementById('leaderboard-btn').style.top = '50%';
        document.getElementById('leaderboard-btn').style.left = '30%';
        
        document.getElementById('exit-btn').style.width = '40%';
        document.getElementById('exit-btn').style.height = '8%';
        document.getElementById('exit-btn').style.top = '60%';
        document.getElementById('exit-btn').style.left = '30%';
      }
    }

    function windowResized() {
      resizeCanvas(windowWidth, windowHeight);
      babyStartY = height / 2 + 50;
      babyTargetY = height / 2 - 50;
      if (babyDelivered) {
        babyY = babyTargetY;
      } else {
        babyY = babyStartY;
      }
      
     
      
      // Adjust button positions for landscape
      if (windowWidth > windowHeight) {
        // Landscape orientation
        document.getElementById('start-btn').style.top = '25%';
        document.getElementById('help-btn').style.top = '35%';
        document.getElementById('leaderboard-btn').style.top = '45%';
        document.getElementById('exit-btn').style.top = '55%';
      } else {
        // Portrait orientation
        document.getElementById('start-btn').style.top = '30%';
        document.getElementById('help-btn').style.top = '40%';
        document.getElementById('leaderboard-btn').style.top = '50%';
        document.getElementById('exit-btn').style.top = '60%';
      }
    }

// Add this function back into your <script>
  function windowResized() {
   // Resize the p5.js canvas to the new window dimensions
   resizeCanvas(windowWidth, windowHeight);

   // Recalculate positions that depend on canvas height/width
   // (Taken from your original code - adjust if needed)
   babyStartY = height / 2 + 50;
   babyTargetY = height / 2 - 50;
   if (babyDelivered) {
     babyY = babyTargetY; // Keep baby at target if delivered
   } else {
      // Only reset babyY if the game hasn't started or baby isn't out yet.
      // If the game is in progress but baby not delivered, might want to lerp instead
      // or just let it be. Resetting might look jarring mid-game.
      // For simplicity, we'll reset it like the original:
      if (!started || !babyDelivered) {
          babyY = babyStartY;
      }
   }
    // Note: You don't need to adjust the HTML button positions here,
    // CSS handles those automatically now.
 }

 // Add these lines back at the very end of your <script>
 window.addEventListener('load', windowResized); // Call once on load to set initial size correctly
 window.addEventListener('resize', windowResized); // Call whenever the window is resized
  </script>
</body>
</html>