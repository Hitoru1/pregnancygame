<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="HandheldFriendly" content="true">
  <!-- Lock orientation to landscape -->
  <meta name="screen-orientation" content="landscape">
  <meta name="full-screen" content="yes">
  <meta name="x5-fullscreen" content="true">
  <meta name="x5-orientation" content="landscape">
  <title>Scream to Deliver</title>

  <!-- External Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/addons/p5.sound.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <!-- Cartoon Font -->
  <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&display=swap" rel="stylesheet">

  <style>
    * {
      box-sizing: border-box;
      touch-action: manipulation;
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      overflow: hidden;
      font-family: 'Comic Neue', cursive;
      background: linear-gradient(to bottom, #c0e6f0, #a7cde2);
    }

    /* Force landscape orientation */
    @media screen and (orientation:portrait) {
      body {
        transform: rotate(90deg);
        transform-origin: left top;
        width: 100vh;
        height: 100vw;
        overflow-x: hidden;
        position: absolute;
        top: 100%;
        left: 0;
      }
    }

    #start-screen {
    position: fixed; /* Changed from absolute to fixed */
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 10;
    animation: fadeIn 0.6s ease-in-out;
  }

  #start-screen img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover; /* Changed from contain to cover */
    z-index: -1;
  }

    .menu-button {
   position: absolute;
   
   background: transparent; 
   border: none;           
   
   cursor: pointer;
   z-index: 11;
   transition: background 0.3s;
   padding: 0;
   margin: 0;
   overflow: hidden;
   text-indent: -9999px;
 }

 
 .menu-button:hover {
   
    background: transparent;

   
   background: rgba(255, 255, 255, 0.1); 
 }

 
 #start-btn { 
   width: 40%;
   height: 45%;
   top: 2%;
   left: 1%;
 }

 #help-btn { 
   width: 17%;
   height: 12%;
   top: 28%;
   left: 41%;
 }

 #leaderboard-btn { 
   width: 33%;
   height: 16%;
   top: 7%;
   left: 58%;
 }

 #exit-btn { 
   width: 28%;
   height: 18%;
   top: 75%;
   left: 68%;
 }

 #mute-btn {
    height: 30px; /* Or use vw/vh/vmin if you want the button itself to scale */
    width: 30px;  /* Or use vw/vh/vmin */
    /* Keep other styles: background, position, border, color, cursor */
    background: transparent;
    position: absolute;
    top: 4%;  /* Consider using vh or % more consistently if needed */
    left: 95%; /* Consider using vw or % more consistently if needed */
    border: none;
    color: white;
    cursor: pointer;
    overflow: hidden; /* Add overflow hidden to contain the pseudo-element */
 }

 #mute-btn::before {
  content: '';
  display: block;
  position: absolute;
  /* --- Responsive Changes --- */
  width: 120%;      /* Make slightly wider than button to ensure full slash */
  height: 10%;      /* Make height relative to button height (e.g., 10% of 30px = 3px) */
  top: 45%;         /* Adjust top offset for vertical centering (50% - height/2) */
  left: -10%;       /* Adjust left offset for horizontal centering */
  /* --- End Responsive Changes --- */
  background: transparent; /* Default state: line is transparent */
  transform: rotate(45deg);
  transform-origin: center center; /* Ensure rotation happens around the center */
  pointer-events: none;
  transition: background-color 0.2s ease; /* Optional: smooth transition */
}

#mute-btn.muted::before {
  background: red; /* Make the line red when muted */
}

/* Optional: If you want the button itself to scale with viewport */
/*
 #mute-btn {
    height: 5vmin;
    width: 5vmin;
    position: absolute;
    top: 2vh;
    right: 2vw;  // Changed from left to right for potentially better placement
    background: transparent;
    border: none;
    color: white;
    cursor: pointer;
    overflow: hidden;
 }
 */

    .home-button {
      position: absolute;
      top: 2vw;
      right: 2vw;
      background-color:#6ab8d3;
      color: white;
      font-size: 4vw;
      padding:.4vw 3vw;
      border-radius: 15px;
      border: none;
      box-shadow: 2px 2px 10px rgba(0,0,0,0.2);
      display: none;
      z-index: 20;
      cursor: pointer;
      font-family: 'Comic Neue', cursive;
    }

    /* Name Input Popup Styles */
    #name-popup {
      position: relative;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(to bottom, #a7cde2, #8ac9db);
      padding: 20px;
      border-radius: 20px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      z-index: 100;
      display: none;
      flex-direction: column;
      align-items: center;
      border: 4px solid #6ab8d3;
      animation: bounceIn 0.5s;
      max-width: 90%;
      width: 350px;
    }

    #name-popup h2 {
      color: #003366;
      margin-top: 0;
      font-size: 1.8rem;
      text-align: center;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    }

    #name-input {
      width: 100%;
      padding: 12px;
      margin: 15px 0;
      border-radius: 10px;
      border: 3px solid #6ab8d3;
      font-family: 'Comic Neue', cursive;
      font-size: 1.1rem;
      outline: none;
      transition: all 0.3s;
    }

    #name-input:focus {
      border-color: #4a99b1;
      box-shadow: 0 0 10px rgba(106, 184, 211, 0.5);
    }

    #continue-btn {
      background-color: #6ab8d3;
      border: none;
      padding: 10px 20px;
      font-size: 1.1rem;
      color: white;
      border-radius: 10px;
      cursor: pointer;
      transition: 0.3s ease;
      font-family: 'Comic Neue', cursive;
      box-shadow: 0 4px 0 #4a99b1;
      width: 100%;
    }

    #continue-btn:hover {
      background-color: #4a99b1;
      transform: translateY(2px);
      box-shadow: 0 2px 0 #3a7d91;
    }

    #continue-btn:active {
      transform: translateY(4px);
      box-shadow: none;
    }

    #name-popup::before {
      content: '';
      position: absolute;
      top: -10px;
      left: -10px;
      right: -10px;
      bottom: -10px;
      border-radius: 25px;
      border: 2px dashed #6ab8d3;
      z-index: -1;
      pointer-events: none;
    }

    /* Congratulations Popup */
    #congrats-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(to bottom, #a7cde2, #8ac9db);
      padding: 20px;
      border-radius: 20px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      z-index: 100;
      display: none;
      flex-direction: column;
      align-items: center;
      border: 4px solid #6ab8d3;
      animation: bounceIn 0.5s;
      max-width: 90%;
      width: 350px;
      text-align: center;
    }

    #congrats-popup h2 {
      color: #003366;
      margin-top: 0;
      font-size: 1.8rem;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    }

    #congrats-popup p {
      font-size: 1.1rem;
      margin-bottom: 15px;
    }

    #congrats-popup img {
      width: 130px;
      height: auto;
      margin: 0 auto 15px;
      display: block;
    }

    #congrats-popup button {
      background-color: #6ab8d3;
      border: none;
      padding: 8px 16px;
      font-size: 1rem;
      color: white;
      border-radius: 10px;
      cursor: pointer;
      transition: 0.3s ease;
      font-family: 'Comic Neue', cursive;
    }

    #congrats-popup button:hover {
      background-color: #4a99b1;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideIn {
      from {
        transform: translateY(-100px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    @keyframes bounceIn {
      0% {
        transform: translate(-50%, -50%) scale(0.8);
        opacity: 0;
      }
      50% {
        transform: translate(-50%, -50%) scale(1.05);
      }
      100% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
      }
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      20%, 60% { transform: translateX(-5px); }
      40%, 80% { transform: translateX(5px); }
    }

    /* Curtain Effect */
    #curtain {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 15;
      display: none;
    }

    #curtain::before, #curtain::after {
      content: '';
      position: absolute;
      top: 0;
      width: 50%;
      height: 100%;
      background: linear-gradient(to bottom, #6ab8d3, #a7cde2);
      z-index: 15;
    }

    #curtain::before {
      left: 0;
    }

    #curtain::after {
      right: 0;
    }

    .close-curtain::before {
      animation: curtainLeft 1.5s forwards;
    }

    .close-curtain::after {
      animation: curtainRight 1.5s forwards;
    }

    @keyframes curtainLeft {
      0% { transform: translateX(0); }
      100% { transform: translateX(-100%); }
    }

    @keyframes curtainRight {
      0% { transform: translateX(0); }
      100% { transform: translateX(100%); }
    }

    canvas {
      display: block;
      position: absolute;
      top: 0;
      left: 0;
      z-index: 1;
    }

    /* Help Screen */
    .help-screen {
    display: none; /* Hidden initially */
    width: 100%;
    height: 100%;
    background-color: black;
    position: fixed;
    top: 0;
    left: 0;
    z-index: 200;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    opacity: 0;
    transform: scale(0.95);
    transition: all 0.3s ease-out;
    pointer-events: none;
  }

  #help-img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    transition: transform 0.3s ease-out 0.1s;
    transform: translateY(20px);
  }

  #close-help {
    height: 40px;
    width: 40px;
    position: absolute;
    background: transparent;
    top: 50px;
    left: 35px;
    border: none;
    color: white;
    cursor: pointer;
  }

    /* Leaderboard Screen */
    .leaderboard-page {
    display: none; /* Hidden initially */
    width: 100%;
    height: 100%;
    background-color: black;
    position: fixed;
    top: 0;
    left: 0;
    z-index: 200;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    opacity: 0;
    transform: scale(0.95);
    transition: all 0.3s ease-out;
    pointer-events: none;
  }

  #leaderboard-img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    transition: transform 0.3s ease-out 0.1s;
    transform: translateY(20px);
  }

  #close-leaderboard {
    height: 40px;
    width: 40px;
    position: absolute;
    background: transparent;
    top: 50px;
    left: 35px;
    border: none;
    color: white;
    cursor: pointer;
  }

  .help-screen.active, .leaderboard-page.active {
    opacity: 1;
    transform: scale(1);
    pointer-events: auto;
    display: flex;
}
.help-screen.active #help-img,
.leaderboard-page.active #leaderboard-img {
    transform: translateY(0);
}

.close-popup-btn {
  position: absolute;
  top: 10px;
  right: 10px;
  background: transparent;
  border: none;
  font-size: 24px;
  cursor: pointer;
  color: #003366;
  font-weight: bold;
  width: 30px;
  height: 30px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: all 0.3s;
}

.close-popup-btn:hover {
  background: rgba(0, 0, 0, 0.1);
  transform: scale(1.1);
}

  </style>
</head>
<body>

  <!-- Start Screen -->
  <div id="start-screen">
    <img src="start_screen_new.png" alt="Start Screen" />
    <button id="start-btn" class="menu-button" onclick="showNamePopup()"></button>
    <button id="help-btn" class="menu-button" onclick="showHelpScreen()"></button>
    <button id="leaderboard-btn" class="menu-button" onclick="showLeaderboard()"></button>
    <button id="exit-btn" class="menu-button" onclick="exitGame()"></button>
    <button id="mute-btn" onclick="muteMusic()"></button>
  </div>

  <!-- Name Input Popup -->
 <!-- Name Input Popup -->
<div id="name-popup">
  <button id="close-name-popup" class="close-popup-btn">√ó</button>
  <h2>What's Your Name?</h2>
  <input type="text" id="name-input" placeholder="Enter your name..." maxlength="20" />
  <div id="name-error" style="color: red; margin-bottom: 10px; display: none;">Please enter your name first!</div>
  <button id="continue-btn" onclick="startGame()">Continue</button>
</div>

  <!-- Home Button (shown during game) -->
  <button class="home-button" id="home-btn" onclick="goHome()">üè† Home</button>

  <!-- Congratulations Popup -->
  <div id="congrats-popup">
    <h2>Congratulations!</h2>
    <p id="congrats-message"></p>
    <img src="https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExc3Y4cWY1bG5mZ2V6d3I0aHh2d3VrY2NlZ3F2eGJtYjR0eGJ4eSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/3o7TKMt1VNMZRZo0e4/giphy.gif" alt="Baby GIF">
    <button onclick="closeCongratsPopup()">OK</button>
  </div>

   <!-- Help Screen -->
  <div id="help-screen" class="help-screen">
    <img id="help-img" src="HELP.png" alt="help img">
    <button id="close-help" onclick="closeHelpScreen()"></button>
  </div>

  <!-- Leaderboard Screen -->
  <div id="leaderboard-page" class="leaderboard-page">
    <img id="leaderboard-img" src="LEADERBOARD_NoName.png" alt="Leaderboard">
    <button id="close-leaderboard" onclick="closeLeaderboard()"></button>
  </div>

  <!-- Curtain Element -->
  <div id="curtain"></div>

  <script>
    let mic, started = false;
    let screamPower = 0, screamGoal = 10, babyDelivered = false;
    let babyY = 320, babyRiseSpeed = 1.5;
   
    let bgMusic, introMusic;
    let confettiPlayed = false;
    let playerName = "";
    let congratsShown = false;
    let babyBounce = 0;
    let babyBounceDirection = 1;
    let lastVolume = 0;
    let babyStartY = 0;
    let babyTargetY = 0;
    let babyProgress = 0;
    let legSpread = 0;
    let gameStartTime = 0;
    let gameEndTime = 0;
    let rightLegImg, leftLegImg, tummyImg, blanketImg, babyImg, bgImg;
    let cryingBabySound;
    let isMuted = false;
    
    function preload() {
  soundFormats('mp3', 'ogg');
  bgMusic = loadSound('background.mp3', () => {}, () => {});
  introMusic = loadSound('bgsong_before_maingame.mp3', () => {}, () => {});
  cryingBabySound = loadSound('crying_baby.mp3', () => {}, () => {});
  // Load all images
  rightLegImg = loadImage('right leg.png');
  leftLegImg = loadImage('left leg.png');
  tummyImg = loadImage('tummy.png');
  blanketImg = loadImage('blanket.png');
  babyImg = loadImage('baby.png');
  bgImg = loadImage('bg_main_game.png');
}

function setup() {
  let canvas = createCanvas(windowWidth, windowHeight);
  canvas.style('display', 'block');
  textAlign(CENTER, CENTER);                      
  textSize(22);
  
  document.getElementById('name-input').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') startGame();
  });
  
  // Set initial baby positions based on image sizes
  babyStartY = height * 0.75; // Start at 75% down screen
  babyTargetY = height * 0.4;  // Rise to 40% of screen
  babyY = babyStartY;
  
  adjustButtonPositions();
  lockOrientation();
}

    function lockOrientation() {
      // Try to lock the screen orientation to landscape
      if (screen.orientation && screen.orientation.lock) {
        screen.orientation.lock('landscape').catch(function(error) {
          console.log('Orientation lock failed: ', error);
        });
      } else if (window.screen.lockOrientation) {
        window.screen.lockOrientation('landscape');
      } else if (window.screen.mozLockOrientation) {
        window.screen.mozLockOrientation('landscape');
      } else if (window.screen.msLockOrientation) {
        window.screen.msLockOrientation('landscape');
      }
    }

    function draw() {
  // Draw background image
  image(bgImg, 0, 0, width, height);
  
  if (!started) return;

  let vol = mic.getLevel();
  let threshold = 0.2;
  vol = lerp(lastVolume, vol, 0.2);
  lastVolume = vol;

  if (!babyDelivered && vol > threshold) {
    screamPower += vol * 0.3;
    screamPower = constrain(screamPower, 0, screamGoal);
    legSpread = map(screamPower, 0, screamGoal, 0, 60);
    
    // Make baby rise based on screamPower (even before delivery)
    babyY = lerp(babyStartY, babyTargetY, screamPower/screamGoal);
  } else if (!babyDelivered) {
    legSpread = lerp(legSpread, 0, 0.05);
    // If not shouting, baby slowly goes back down
    babyY = lerp(babyY, babyStartY, 0.05);
  }

  // Draw UI elements (keep these)
  fill(0);
  textSize(windowWidth > windowHeight ? 18 : 14);
  text(`Volume: ${vol.toFixed(2)}`, width / 2, 30);
  
  // Progress bar
  noStroke();
  fill('#8ac9db');
  rect(width / 2 - 100, 60, (screamPower / screamGoal) * 200, 20, 10);
  stroke(0);
  noFill();
  rect(width / 2 - 100, 60, 200, 20, 10);

  if (started && !babyDelivered) {
  // Calculate time components
  const elapsed = millis() - gameStartTime;
  const seconds = Math.floor(elapsed / 1000) % 60;
  const minutes = Math.floor(elapsed / (1000 * 60)) % 60;
  const hours = Math.floor(elapsed / (1000 * 60 * 60));
  
  // Format as 00:00:00
  const formattedTime = [
    hours.toString().padStart(2, '0'),
    minutes.toString().padStart(2, '0'), 
    seconds.toString().padStart(2, '0')
  ].join(':');

  const timerY = 58; // Main timer position (was 30)
  const shadowY = 58; // Shadow position (was 32)

  // Stylish text display
  fill(255); // White text
  stroke(0); // Black outline
  strokeWeight(2); // Thicker outline
  textSize(windowWidth > windowHeight ? 24 : 20); // Slightly larger
  textFont('Comic Neue'); // Use your loaded font
  textAlign(CENTER, TOP); // Center horizontally, align to top
  
  // Draw text shadow
  fill(0, 0, 0, 100); // 100/255 opacity (~40%)
  noStroke();
  text(formattedTime, width/2 + 2, shadowY);
  
  // Draw main text (semi-transparent blue)
  fill(30, 144, 255, 130); // DodgerBlue with 200/255 opacity (~80%)
  text(formattedTime, width/2, timerY);
  
  // Reset styles
  noStroke();
}

  let legWidth = width * 0.5;
  let legHeight = legWidth * (leftLegImg.height/leftLegImg.width);
  
  let tummyWidth = width * 0.8;
  let tummyHeight = tummyWidth * (tummyImg.height/tummyImg.width);
  
  let babyWidth = width * 0.2;
  let babyHeight = babyWidth * (babyImg.height/babyImg.width);

  
  // If keeping blanket, add this before drawing legs/tummy:
let blanketWidth = width * 1.4;
let blanketHeight = blanketWidth * (blanketImg.height/blanketImg.width);

  
  
  // Draw legs with spread effect
  image(leftLegImg, 
       width/2 - legWidth - legSpread/2, 
       height/1 - legHeight/1, 
       legWidth, 
       legHeight);
  
        image(rightLegImg, 
        width/2 + legSpread/2, 
        height/1 - legHeight/1, 
        legWidth, 
        legHeight);

        image(babyImg, 
       width/2 - babyWidth/2, 
       babyY + babyBounce, 
       babyWidth, 
       babyHeight);

  // Draw tummy
  image(tummyImg, 
       width/2 - tummyWidth/2, 
       height/1 - tummyHeight/1, 
       tummyWidth, 
       tummyHeight);

  // Draw blanket (static position)
  image(blanketImg, 
     width/2 - blanketWidth/2, 
     height/2 - blanketHeight/2, 
     blanketWidth, 
     blanketHeight);

  // Baby delivery logic
  if (screamPower >= screamGoal) {
    babyDelivered = true;
    gameEndTime = millis();
    babyProgress = min(babyProgress + 0.01, 1);
    babyY = lerp(babyStartY, babyTargetY, babyProgress);
    
    if (babyProgress >= 1) {
      babyBounce += 0.1 * babyBounceDirection;
      if (abs(babyBounce) > 5) babyBounceDirection *= -1;
    }
  }

  // Draw baby if delivered
  if (babyDelivered) {
    image(babyImg, 
         width/2 - babyWidth/2, 
         babyY + babyBounce, 
         babyWidth, 
         babyHeight);
    
    if (!confettiPlayed && babyProgress > 0.5) {
      launchConfetti();
      confettiPlayed = true;
    }

    if (!congratsShown && babyProgress >= 1) {
      showCongratsPopup();
      congratsShown = true;
    }
    if (cryingBabySound && !cryingBabySound.isPlaying()) {
    cryingBabySound.play();
    cryingBabySound.setVolume(0.5); // Adjust volume as needed
  }
  } else {
    fill(0);
    textSize(windowWidth > windowHeight ? 20 : 16);
    
  }
}


    function launchConfetti() {
      confetti({
        particleCount: 150,
        spread: 100,
        origin: { x: 0, y: 0.5 },
        angle: 45,
        colors: ['#f72585', '#b5179e', '#7209b7', '#3a0ca3', '#4361ee', '#4cc9f0'],
        scalar: 1.2,
        duration: 5000
      });

      confetti({
        particleCount: 150,
        spread: 100,
        origin: { x: 1, y: 0.5 },
        angle: 135,
        colors: ['#f72585', '#b5179e', '#7209b7', '#3a0ca3', '#4361ee', '#4cc9f0'],
        scalar: 1.2,
        duration: 5000
      });
    }

    function showCongratsPopup() {
  // Set a delay of 2 seconds (2000ms) before showing the popup
  setTimeout(() => {
    const timeTaken = ((gameEndTime - gameStartTime)/1000).toFixed(1);
    const message = playerName ? 
      `Congratulations ${playerName}! You delivered the baby in ${timeTaken} seconds!` : 
      `Congratulations! You delivered the baby in ${timeTaken} seconds!`;
    document.getElementById('congrats-message').textContent = message;
    document.getElementById('congrats-popup').style.display = 'flex';
    
    // Add animation to the popup when it appears
    document.getElementById('congrats-popup').style.animation = 'bounceIn 0.5s';
  }, 2000); // 2000 milliseconds = 2 seconds
}

    function closeCongratsPopup() {
      document.getElementById('congrats-popup').style.display = 'none';
    }

    function showNamePopup() {
      document.getElementById('start-screen').style.display = 'none';
      document.getElementById('name-popup').style.display = 'flex';
      document.getElementById('name-input').value = '';
      document.getElementById('name-error').style.display = 'none';
      document.getElementById('name-input').focus();
    }

    function startGame() {
      const nameInput = document.getElementById('name-input');
      const errorMessage = document.getElementById('name-error');
      
      playerName = nameInput.value.trim();
      
      if (playerName === "") {
        errorMessage.style.display = 'block';
        nameInput.style.animation = 'shake 0.5s';
        setTimeout(() => {
          nameInput.style.animation = '';
        }, 500);
        return;
      }
      
      errorMessage.style.display = 'none';
      document.getElementById('name-popup').style.display = 'none';
      
      const curtain = document.getElementById('curtain');
      curtain.style.display = 'block';
      curtain.classList.add('close-curtain');

      document.getElementById('start-screen').style.display = 'none';

      

      setTimeout(() => {
        document.getElementById('home-btn').style.display = 'block';
        curtain.style.display = 'none';
        stopIntroMusic();
        playBackgroundMusic();

        mic = new p5.AudioIn();
        mic.start(() => {}, () => alert("Please allow microphone access!"));
        userStartAudio();

        // Reset game state
        started = true;
        screamPower = 0;
        babyDelivered = false;
        confettiPlayed = false;
        congratsShown = false;
        babyProgress = 0;
        babyY = height / 2 + 50;
        babyStartY = height / 2 + 50;
        babyTargetY = height / 2 - 50;
        legSpread = 0;
        gameStartTime = millis();
      }, 1000);
    }

    function muteMusic() {
        isMuted = !isMuted;

        const muteButton = document.getElementById('mute-btn');

        if (isMuted) {
          if (introMusic && introMusic.isPlaying()) {
            introMusic.setVolume(0);
          }
          muteButton.classList.add('muted');
        } else {
          if (introMusic && introMusic.isPlaying()) {
            introMusic.setVolume(0.3); // Or whatever default volume you prefer
          }
          muteButton.classList.remove('muted');
        }
      }

    function goHome() {
      started = false;
      screamPower = 0;
      babyDelivered = false;
      confettiPlayed = false;
      congratsShown = false;
      playerName = "";
      
      if (cryingBabySound && cryingBabySound.isPlaying()) {
    cryingBabySound.stop();
  }
      
      document.getElementById('congrats-popup').style.display = 'none';
      document.getElementById('start-screen').style.display = 'flex';
      document.getElementById('home-btn').style.display = 'none';
      if (bgMusic && bgMusic.isPlaying()) {
        bgMusic.stop();
      }
      playIntroMusic();
    }

    function showHelpScreen() {
    const helpScreen = document.getElementById('help-screen');
    helpScreen.style.display = 'flex';
    setTimeout(() => {
        helpScreen.classList.add('active');
    }, 10);
}

function closeHelpScreen() {
    const helpScreen = document.getElementById('help-screen');
    helpScreen.classList.remove('active');
    setTimeout(() => {
        helpScreen.style.display = 'none';
    }, 300);
}

function closeNamePopup() {
  document.getElementById('name-popup').style.display = 'none';
  document.getElementById('start-screen').style.display = 'flex';
}

// Add event listener for the close button
document.getElementById('close-name-popup').addEventListener('click', closeNamePopup);


function showLeaderboard() {
    const leaderboard = document.getElementById('leaderboard-page');
    leaderboard.style.display = 'flex';
    setTimeout(() => {
        leaderboard.classList.add('active');
    }, 10);
}

function closeLeaderboard() {
    const leaderboard = document.getElementById('leaderboard-page');
    leaderboard.classList.remove('active');
    setTimeout(() => {
        leaderboard.style.display = 'none';
    }, 300);
}

    function exitGame() {
      // In a real app, this might close the window or app
      // For web, we'll just show an alert
      alert("Thanks for playing! The game would exit here in a native app.");
    }

    function playIntroMusic() {
      if (introMusic && !introMusic.isPlaying()) {
        introMusic.loop();
        introMusic.setVolume(0.3);
      }
    }

    function stopIntroMusic() {
      if (introMusic && introMusic.isPlaying()) {
        introMusic.stop();
      }
    }

    function playBackgroundMusic() {
      if (bgMusic && !bgMusic.isPlaying()) {
        bgMusic.loop();
        bgMusic.setVolume(0.3);
      }
    }

    function adjustButtonPositions() {
      // These values should be adjusted based on your start_screen_new.png layout
      if (windowWidth > windowHeight) {
        // Landscape orientation
        document.getElementById('start-btn').style.width = '38%';
        document.getElementById('start-btn').style.height = '30%';
        document.getElementById('start-btn').style.top = '4%';
        document.getElementById('start-btn').style.left = '1%';
        
        document.getElementById('help-btn').style.width = '15%';
        document.getElementById('help-btn').style.height = '10%';
        document.getElementById('help-btn').style.top = '42%';
        document.getElementById('help-btn').style.left = '10%';
        
        document.getElementById('leaderboard-btn').style.width = '25%';
        document.getElementById('leaderboard-btn').style.height = '10%';
        document.getElementById('leaderboard-btn').style.top = '54%';
        document.getElementById('leaderboard-btn').style.left = '10%';
        
        document.getElementById('exit-btn').style.width = '15%';
        document.getElementById('exit-btn').style.height = '10%';
        document.getElementById('exit-btn').style.top = '68%';
        document.getElementById('exit-btn').style.left = '10%';
      } else {
        // Portrait orientation (will be rotated to landscape)
        document.getElementById('start-btn').style.width = '40%';
        document.getElementById('start-btn').style.height = '8%';
        document.getElementById('start-btn').style.top = '30%';
        document.getElementById('start-btn').style.left = '30%';
        
        document.getElementById('help-btn').style.width = '40%';
        document.getElementById('help-btn').style.height = '8%';
        document.getElementById('help-btn').style.top = '40%';
        document.getElementById('help-btn').style.left = '30%';
        
        document.getElementById('leaderboard-btn').style.width = '40%';
        document.getElementById('leaderboard-btn').style.height = '8%';
        document.getElementById('leaderboard-btn').style.top = '50%';
        document.getElementById('leaderboard-btn').style.left = '30%';
        
        document.getElementById('exit-btn').style.width = '40%';
        document.getElementById('exit-btn').style.height = '8%';
        document.getElementById('exit-btn').style.top = '60%';
        document.getElementById('exit-btn').style.left = '30%';
      }
    }

    function windowResized() {
      resizeCanvas(windowWidth, windowHeight);
      babyStartY = height / 2 + 50;
      babyTargetY = height / 2 - 50;
      if (babyDelivered) {
        babyY = babyTargetY;
      } else {
        babyY = babyStartY;
      }
      
     
      
      // Adjust button positions for landscape
      if (windowWidth > windowHeight) {
        // Landscape orientation
        document.getElementById('start-btn').style.top = '25%';
        document.getElementById('help-btn').style.top = '35%';
        document.getElementById('leaderboard-btn').style.top = '45%';
        document.getElementById('exit-btn').style.top = '55%';
      } else {
        // Portrait orientation
        document.getElementById('start-btn').style.top = '30%';
        document.getElementById('help-btn').style.top = '40%';
        document.getElementById('leaderboard-btn').style.top = '50%';
        document.getElementById('exit-btn').style.top = '60%';
      }
    }

// Add this function back into your <script>
  function windowResized() {
   // Resize the p5.js canvas to the new window dimensions
   resizeCanvas(windowWidth, windowHeight);

   // Recalculate positions that depend on canvas height/width
   // (Taken from your original code - adjust if needed)
   babyStartY = height / 2 + 50;
   babyTargetY = height / 2 - 50;
   if (babyDelivered) {
     babyY = babyTargetY; // Keep baby at target if delivered
   } else {
      // Only reset babyY if the game hasn't started or baby isn't out yet.
      // If the game is in progress but baby not delivered, might want to lerp instead
      // or just let it be. Resetting might look jarring mid-game.
      // For simplicity, we'll reset it like the original:
      if (!started || !babyDelivered) {
          babyY = babyStartY;
      }
   }
    // Note: You don't need to adjust the HTML button positions here,
    // CSS handles those automatically now.
 }

 // Add these lines back at the very end of your <script>
 window.addEventListener('load', windowResized); // Call once on load to set initial size correctly
 window.addEventListener('resize', windowResized); // Call whenever the window is resized

 function handleFirstInteraction() {
  playIntroMusic();
  window.removeEventListener('click', handleFirstInteraction);
  window.removeEventListener('touchstart', handleFirstInteraction);
}

window.addEventListener('click', handleFirstInteraction);
window.addEventListener('touchstart', handleFirstInteraction);

  </script>
</body>
</html>